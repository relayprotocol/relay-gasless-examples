import{q as Os,r as Ds,t as G,u as Et,v as $n,x as Cs,y as Ts,z as Bt,A as Ss,C as Ns,D as _s,G as ze,I as $s,J as Us,K as Rs,L as Ls,M as qs,N as Un,O as Ks,B as Ze,P as Bs,Q as Fs,R as Ys,S as Ws,V as Qs,X as Xt,Y as Vs,Z as Hs,$ as Zs,a0 as C,a1 as Gs,a2 as Te,a3 as te,a4 as Nt,a5 as me,a6 as Js,a7 as Xs,a8 as Q,a9 as Z,aa as _,ab as J,ac as Pe,ad as lt,ae as _t,af as Rn,ag as Se,ah as xr,ai as ei,aj as se,ak as Ln,al as en,am as qn,an as Xe,ao as ti,ap as ni,aq as ri,d as si,ar as ii,as as oi,at as L,au as Kn,av as V,aw as Er,ax as $t,ay as ai,az as ci,aA as Bn,aB as Ge,aC as Fn,aD as ui,aE as Yn,aF as Wn,aG as Qn,aH as Vn,aI as Hn,aJ as Zn,aK as di,c as li,aL as Ut,aM as kr,aN as fi,aO as pi,aP as hi,aQ as yi,aR as mi,aS as gi,aT as wi,aU as bi,aV as Ii,aW as Mi,aX as vi,aY as Mn,aZ as xi,a_ as Ar,a$ as jr,b0 as Ei,b1 as ki,b2 as Ai,b3 as ji,b4 as Pi,b5 as zi,b6 as Oi,b7 as Di,b8 as vn,b9 as Ci,ba as Ti,bb as kt,bc as At,bd as Si,be as Ni,bf as _i,bg as $i,bh as Ui,bi as Ri,bj as Li,bk as qi,bl as Ki,bm as Ve}from"./index-CFybCH-C.js";import{s as xn,p as jt,c as Bi,d as Fi,a as Yi,b as Wi}from"./vanilla-BJClVuBa.js";import{f as Qi}from"./fallback-BJB4NYYu.js";import{c as Vi,s as Hi,d as Zi,g as Gi}from"./index-nibyPLVP.js";function Ji(e,t={}){return Ds(e,t)}function Xi(e){return Os(e)}const eo=G({id:31337,name:"Anvil",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"},rpcUrls:{default:{http:["http://127.0.0.1:8545"],webSocket:["ws://127.0.0.1:8545"]}}}),to=G({id:421614,name:"Arbitrum Sepolia",blockTime:250,nativeCurrency:{name:"Arbitrum Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://sepolia-rollup.arbitrum.io/rpc"]}},blockExplorers:{default:{name:"Arbiscan",url:"https://sepolia.arbiscan.io",apiUrl:"https://api-sepolia.arbiscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:81930}},testnet:!0}),Ke=11155111,Pr=G({...Et,id:84532,network:"base-sepolia",name:"Base Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://sepolia.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://sepolia.basescan.org",apiUrl:"https://api-sepolia.basescan.org/api"}},contracts:{...Et.contracts,disputeGameFactory:{[Ke]:{address:"0xd6E6dBf4F7EA0ac412fD8b65ED297e64BB7a06E1"}},l2OutputOracle:{[Ke]:{address:"0x84457ca9D0163FbC4bbfe4Dfbb20ba46e48DF254"}},portal:{[Ke]:{address:"0x49f53e41452c74589e85ca1677426ba426459e85",blockCreated:4446677}},l1StandardBridge:{[Ke]:{address:"0xfd0Bf71F60660E2f608ed56e1659C450eB113120",blockCreated:4446677}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:1059647}},testnet:!0,sourceId:Ke});({...Pr});const no=G({id:80094,name:"Berachain",blockTime:2e3,nativeCurrency:{decimals:18,name:"BERA Token",symbol:"BERA"},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0},ensRegistry:{address:"0x5b22280886a2f5e09a49bea7e320eab0e5320e28",blockCreated:877007},ensUniversalResolver:{address:"0x4D41762915F83c76EcaF6776d9b08076aA32b492",blockCreated:9310021}},rpcUrls:{default:{http:["https://rpc.berachain.com"]}},blockExplorers:{default:{name:"Berascan",url:"https://berascan.com"}},ensTlds:[".bera"],testnet:!1}),ro=G({id:80069,blockTime:2e3,name:"Berachain Bepolia",nativeCurrency:{decimals:18,name:"BERA Token",symbol:"BERA"},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0}},rpcUrls:{default:{http:["https://bepolia.rpc.berachain.com"]}},blockExplorers:{default:{name:"Berascan",url:"https://bepolia.beratrail.io"}},testnet:!0}),so=G({id:56,name:"BNB Smart Chain",blockTime:750,nativeCurrency:{decimals:18,name:"BNB",symbol:"BNB"},rpcUrls:{default:{http:["https://56.rpc.thirdweb.com"]}},blockExplorers:{default:{name:"BscScan",url:"https://bscscan.com",apiUrl:"https://api.bscscan.com/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:15921452}}}),io={estimateFeesPerGas:async e=>{var s;if(!((s=e.request)!=null&&s.feeCurrency))return null;const[t,n]=await Promise.all([oo(e.client,e.request.feeCurrency),ao(e.client,e.request.feeCurrency)]);return{maxFeePerGas:e.multiply(t-n)+n,maxPriorityFeePerGas:n}}};async function oo(e,t){const n=await e.request({method:"eth_gasPrice",params:[t]});return BigInt(n)}async function ao(e,t){const n=await e.request({method:"eth_maxPriorityFeePerGas",params:[t]});return BigInt(n)}function zr(e){return e===0||e===0n||e===void 0||e===null||e==="0"||e===""||typeof e=="string"&&($n(e).toLowerCase()==="0x"||$n(e).toLowerCase()==="0x00")}function He(e){return!zr(e)}function co(e){return typeof e.maxFeePerGas<"u"&&typeof e.maxPriorityFeePerGas<"u"}function Or(e){return e.type==="cip64"?!0:co(e)&&He(e.feeCurrency)}const uo={block:Ss({format(e){var n;return{transactions:(n=e.transactions)==null?void 0:n.map(r=>typeof r=="string"?r:{...Ns(r),...r.gatewayFee?{gatewayFee:Bt(r.gatewayFee),gatewayFeeRecipient:r.gatewayFeeRecipient}:{},feeCurrency:r.feeCurrency})}}}),transaction:Ts({format(e){if(e.type==="0x7e")return{isSystemTx:e.isSystemTx,mint:e.mint?Bt(e.mint):void 0,sourceHash:e.sourceHash,type:"deposit"};const t={feeCurrency:e.feeCurrency};return e.type==="0x7b"?t.type="cip64":(e.type==="0x7c"&&(t.type="cip42"),t.gatewayFee=e.gatewayFee?Bt(e.gatewayFee):null,t.gatewayFeeRecipient=e.gatewayFeeRecipient),t}}),transactionRequest:Cs({format(e){const t={};return e.feeCurrency&&(t.feeCurrency=e.feeCurrency),Or(e)&&(t.type="0x7b"),t}})};function lo(e,t){return Or(e)?po(e,t):_s(e,t)}const fo={transaction:lo};function po(e,t){yo(e);const{chainId:n,gas:r,nonce:s,to:i,value:a,maxFeePerGas:u,maxPriorityFeePerGas:c,accessList:o,feeCurrency:d,data:f}=e,l=[ze(n),s?ze(s):"0x",c?ze(c):"0x",u?ze(u):"0x",r?ze(r):"0x",i??"0x",a?ze(a):"0x",f??"0x",$s(o),d,...Us(e,t)];return Rs(["0x7b",Ls(l)])}const ho=Ys;function yo(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:r,maxFeePerGas:s,to:i,feeCurrency:a}=e;if(t<=0)throw new qs({chainId:t});if(i&&!Un(i))throw new Ks({address:i});if(r)throw new Ze("`gasPrice` is not a valid CIP-64 Transaction attribute.");if(He(s)&&s>ho)throw new Bs({maxFeePerGas:s});if(He(n)&&He(s)&&n>s)throw new Fs({maxFeePerGas:s,maxPriorityFeePerGas:n});if(He(a)&&!Un(a))throw new Ze("`feeCurrency` MUST be a token address for CIP-64 transactions.");if(zr(a))throw new Ze("`feeCurrency` must be provided for CIP-64 transactions.")}const mo={blockTime:1e3,contracts:Ws,formatters:uo,serializers:fo,fees:io},go=G({...mo,id:42220,name:"Celo",nativeCurrency:{decimals:18,name:"CELO",symbol:"CELO"},rpcUrls:{default:{http:["https://forno.celo.org"]}},blockExplorers:{default:{name:"Celo Explorer",url:"https://celoscan.io",apiUrl:"https://api.celoscan.io/api"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:13112599}},testnet:!1}),wo=G({id:100,name:"Gnosis",nativeCurrency:{decimals:18,name:"xDAI",symbol:"XDAI"},blockTime:5e3,rpcUrls:{default:{http:["https://rpc.gnosischain.com"],webSocket:["wss://rpc.gnosischain.com/wss"]}},blockExplorers:{default:{name:"Gnosisscan",url:"https://gnosisscan.io",apiUrl:"https://api.gnosisscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:21022491}}}),bo=G({id:560048,name:"Hoodi",nativeCurrency:{name:"Hoodi Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://rpc.hoodi.ethpandaops.io"]}},blockExplorers:{default:{name:"Etherscan",url:"https://hoodi.etherscan.io"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:2589}},testnet:!0}),Io=G({id:747474,name:"Katana",network:"katana",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://rpc.katana.network"]}},blockExplorers:{default:{name:"katana explorer",url:"https://katanascan.com"}},testnet:!1}),Be=11155111,Mo=G({...Et,id:11155420,name:"OP Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://sepolia.optimism.io"]}},blockExplorers:{default:{name:"Blockscout",url:"https://optimism-sepolia.blockscout.com",apiUrl:"https://optimism-sepolia.blockscout.com/api"}},contracts:{...Et.contracts,disputeGameFactory:{[Be]:{address:"0x05F9613aDB30026FFd634f38e5C4dFd30a197Fa1"}},l2OutputOracle:{[Be]:{address:"0x90E9c4f8a994a250F6aEfd61CAFb4F2e895D458F"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:1620204},portal:{[Be]:{address:"0x16Fc5058F25648194471939df75CF27A2fdC48BC"}},l1StandardBridge:{[Be]:{address:"0xFBb0621E0B23b5478B630BD55a5f21f67730B0F1"}}},testnet:!0,sourceId:Be}),vo=G({id:137,name:"Polygon",blockTime:2e3,nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:25770160}}}),xo=G({id:11155111,name:"Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://11155111.rpc.thirdweb.com"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.etherscan.io",apiUrl:"https://api-sepolia.etherscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:751532},ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:8928790}},testnet:!0}),Eo=Object.freeze(Object.defineProperty({__proto__:null,arbitrum:Qs,arbitrumSepolia:to,base:Xt,baseSepolia:Pr,berachain:no,berachainBepolia:ro,bsc:so,celo:go,gnosis:wo,hoodi:bo,katana:Io,mainnet:Vs,optimism:Hs,optimismSepolia:Mo,polygon:vo,sepolia:xo},Symbol.toStringTag,{value:"Module"})),ko=[Xt,...Object.values(Eo).filter(e=>e&&e.id!==Xt.id)],Dr=eo;({...Dr});({...Dr});function Ao(e,t={}){const{raw:n=!1}=t,r=e;if(n)return e;if(r.error)throw Cr(r.error);return r.result}function Cr(e){const t=e;if(t instanceof Error&&!("code"in t))return new he({cause:t,data:t,message:t.message,stack:t.stack});const{code:n}=t;return n===he.code?new he(t):n===tn.code?new tn(t):n===xe.code?new xe(t):n===st.code?new st(t):n===nt.code?new nt(t):n===it.code?new it(t):n===ve.code?new ve(t):n===ot.code?new ot(t):n===et.code?new et(t):n===tt.code?new tt(t):n===Me.code?new Me(t):n===rt.code?new rt(t):new he({cause:t instanceof Error?t:void 0,data:t,message:t.message,stack:t instanceof Error?t.stack:void 0})}class oe extends Error{constructor(t){const{cause:n,code:r,message:s,data:i,stack:a}=t;super(s,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.BaseError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stack",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=n,this.code=r,this.data=i,this.stack=a??""}}let tn=class Tr extends oe{constructor(t={}){super({code:Tr.code,data:t.data,message:t.message??"Missing or invalid parameters."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.InvalidInputError"})}};Object.defineProperty(tn,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class et extends oe{constructor(t={}){super({code:et.code,data:t.data,message:t.message??"Requested resource not found."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.ResourceNotFoundError"})}}Object.defineProperty(et,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class tt extends oe{constructor(t={}){super({code:tt.code,data:t.data,message:t.message??"Requested resource not available."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.ResourceUnavailableError"})}}Object.defineProperty(tt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class Me extends oe{constructor(t={}){super({code:Me.code,data:t.data,message:t.message??"Transaction creation failed."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.TransactionRejectedError"})}}Object.defineProperty(Me,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class ve extends oe{constructor(t={}){super({code:ve.code,data:t.data,message:t.message??"Method is not implemented."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.MethodNotSupportedError"})}}Object.defineProperty(ve,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class nt extends oe{constructor(t={}){super({code:nt.code,data:t.data,message:t.message??"Rate limit exceeded."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.LimitExceededError"})}}Object.defineProperty(nt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class rt extends oe{constructor(t={}){super({code:rt.code,data:t.data,message:t.message??"JSON-RPC version not supported."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.VersionNotSupportedError"})}}Object.defineProperty(rt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class st extends oe{constructor(t={}){super({code:st.code,data:t.data,message:t.message??"Input is not a valid JSON-RPC request."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.InvalidRequestError"})}}Object.defineProperty(st,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class it extends oe{constructor(t={}){super({code:it.code,data:t.data,message:t.message??"Method does not exist."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.MethodNotFoundError"})}}Object.defineProperty(it,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class xe extends oe{constructor(t={}){super({code:xe.code,data:t.data,message:t.message??"Invalid method parameters."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.InvalidParamsError"})}}Object.defineProperty(xe,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class he extends oe{constructor(t={}){super({cause:t.cause,code:he.code,data:t.data,message:t.message??"Internal JSON-RPC error.",stack:t.stack}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.InternalError"})}}Object.defineProperty(he,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class ot extends oe{constructor(t={}){super({code:ot.code,data:t.data,message:t.message??"Failed to parse JSON-RPC response."}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcResponse.ParseError"})}}Object.defineProperty(ot,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class re extends Error{constructor(t,n){super(n),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderRpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t,this.details=n}}class Ne extends re{constructor({message:t="The user rejected the request."}={}){super(4001,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.UserRejectedRequestError"})}}Object.defineProperty(Ne,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class Y extends re{constructor({message:t="The requested method and/or account has not been authorized by the user."}={}){super(4100,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.UnauthorizedError"})}}Object.defineProperty(Y,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class at extends re{constructor({message:t="The provider does not support the requested method."}={}){super(4200,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.UnsupportedMethodError"})}}Object.defineProperty(at,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class W extends re{constructor({message:t="The provider is disconnected from all chains."}={}){super(4900,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.DisconnectedError"})}}Object.defineProperty(W,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class pe extends re{constructor({message:t="The provider is not connected to the requested chain."}={}){super(4901,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.ChainDisconnectedError"})}}Object.defineProperty(pe,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class nn extends re{constructor({message:t="An error occurred when attempting to switch chain."}={}){super(4902,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.SwitchChainError"})}}Object.defineProperty(nn,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});class rn extends re{constructor({message:t="This Wallet does not support a capability that was not marked as optional."}={}){super(5700,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.UnsupportedNonOptionalCapabilityError"})}}Object.defineProperty(rn,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});class Pt extends re{constructor({message:t="This Wallet does not support the requested chain ID."}={}){super(5710,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.UnsupportedChainIdError"})}}Object.defineProperty(Pt,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});class sn extends re{constructor({message:t="There is already a bundle submitted with this ID."}={}){super(5720,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.DuplicateIdError"})}}Object.defineProperty(sn,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});class ct extends re{constructor({message:t="This bundle id is unknown / has not been submitted."}={}){super(5730,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.UnknownBundleIdError"})}}Object.defineProperty(ct,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});class on extends re{constructor({message:t="The call bundle is too large for the Wallet to process."}={}){super(5740,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.BundleTooLargeError"})}}Object.defineProperty(on,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});class an extends re{constructor({message:t="The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."}={}){super(5750,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.AtomicReadyWalletRejectedUpgradeError"})}}Object.defineProperty(an,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});class cn extends re{constructor({message:t="The wallet does not support atomic execution but the request requires it."}={}){super(5760,t),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.AtomicityNotSupportedError"})}}Object.defineProperty(cn,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});function jo(){const e=new Zs;return{get eventNames(){return e.eventNames.bind(e)},get listenerCount(){return e.listenerCount.bind(e)},get listeners(){return e.listeners.bind(e)},addListener:e.addListener.bind(e),emit:e.emit.bind(e),off:e.off.bind(e),on:e.on.bind(e),once:e.once.bind(e),removeAllListeners:e.removeAllListeners.bind(e),removeListener:e.removeListener.bind(e)}}function Sr(e,t={}){if(!e)throw new Po;return{...e,async request(n){try{const r=await e.request(n);return r&&typeof r=="object"&&"jsonrpc"in r?Ao(r):r}catch(r){throw Nr(r)}}}}function Nr(e){const t=Cr(e);if(t instanceof he){if(!t.data)return t;const{code:n}=t.data;if(n===W.code)return new W(t);if(n===pe.code)return new pe(t);if(n===Ne.code)return new Ne(t);if(n===Y.code)return new Y(t);if(n===at.code)return new at(t);if(n===nn.code)return new nn(t);if(n===an.code)return new an(t);if(n===cn.code)return new cn(t);if(n===on.code)return new on(t);if(n===ct.code)return new ct(t);if(n===sn.code)return new sn(t);if(n===Pt.code)return new Pt(t);if(n===rn.code)return new rn(t)}return t}class Po extends C{constructor(){super("`provider` is undefined."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Provider.IsUndefinedError"})}}const zo=()=>"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in IntersectionObserverEntry.prototype&&"isVisible"in IntersectionObserverEntry.prototype;function Oo(e={}){const{prefix:t="[Porto]"}=e,n=new Set;return{error:Oe(console.error,{prefix:t}),errorOnce:Oe(console.error,{memo:n,prefix:t}),log:Oe(console.log,{prefix:t}),logOnce:Oe(console.log,{memo:n,prefix:t}),warn:Oe(console.warn,{prefix:t}),warnOnce:Oe(console.warn,{memo:n,prefix:t})}}const Gn=Oo();function Oe(e,t={}){const{memo:n,prefix:r}=t;return(...s)=>{const i=s.join(" ");n!=null&&n.has(i)||(n==null||n.add(i),e(`${r} ${i}`))}}function Do(){const e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")}function Co(){const e=navigator.userAgent.toLowerCase();return(e.includes("firefox")||e.includes("fxios"))&&!e.includes("seamonkey")}function To(){var e,t;return(t=(e=window.navigator)==null?void 0:e.userAgentData)!=null&&t.mobile?!0:navigator.maxTouchPoints>1||/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(navigator.userAgent.slice(0,4))}function So(){let e=()=>{},t=()=>{};return{promise:new Promise((r,s)=>{e=r,t=s}),reject:t,resolve:e}}function _e(e){if(Array.isArray(e))return e.map(_e);if(typeof e=="function")return;if(typeof e!="object"||e===null)return e;if(Object.getPrototypeOf(e)!==Object.prototype)try{return structuredClone(e)}catch{return}const t={};for(const[n,r]of Object.entries(e))t[n]=_e(r);return t}function _r(e,t){const n=[],r=new Set;for(const s of e){const i=t(s);r.has(i)||(r.add(i),n.push(s))}return n}function En(){return typeof globalThis<"u"&&"crypto"in globalThis?globalThis.crypto.randomUUID():crypto.randomUUID()}function be(e,{enabled:t=!0,id:n}){if(!t||!n)return e();if(be.cache.get(n))return be.cache.get(n);const r=e().finally(()=>be.cache.delete(n));return be.cache.set(n,r),r}(function(e){e.cache=new Map})(be||(be={}));function zt(e,t={}){const{targetOrigin:n}=t,r=new Map;return{destroy(){for(const s of r.values())e.removeEventListener("message",s)},on(s,i,a){function u(c){c.data.topic===s&&(a&&c.data.id!==a||n&&c.origin!==n||i(c.data.payload,c))}return e.addEventListener("message",u),r.set(s,u),()=>e.removeEventListener("message",u)},async send(s,i,a){const u=En();return e.postMessage(_e({id:u,payload:i,topic:s}),a??n??"*"),{id:u,payload:i,topic:s}},async sendAsync(s,i,a){const{id:u}=await this.send(s,i,a);return new Promise(c=>this.on(s,c,u))}}}function $r(e){const{from:t,to:n,waitForReady:r=!1}=e;let s=!1;const i=So();t.on("ready",i.resolve);const a={destroy(){t.destroy(),n.destroy(),s&&i.reject()},on(u,c,o){return t.on(u,c,o)},async send(u,c){return s=!0,r&&await i.promise.finally(()=>s=!1),n.send(u,c)},async sendAsync(u,c){return s=!0,r&&await i.promise.finally(()=>s=!1),n.sendAsync(u,c)}};return{...a,ready(u){a.send("ready",u)},waitForReady(){return i.promise}}}const Ur={prod:"https://id.porto.sh/dialog"};function No(e={}){const{skipProtocolCheck:t,skipUnsupported:n}=e,r=s=>!n&&Do()&&(s==null?void 0:s.some(i=>["wallet_connect","eth_requestAccounts"].includes(i.method)));return typeof window>"u"?Rr():{name:"iframe",setup(s){const{host:i,internal:a,theme:u,themeController:c}=s,{store:o}=a,d=_o().setup(s);let f=!1;const l=new URL(i),p=document.createElement("dialog");p.dataset.porto="",p.setAttribute("role","dialog"),p.setAttribute("aria-closed","true"),p.setAttribute("aria-label","Porto Wallet"),p.setAttribute("hidden","until-found"),Object.assign(p.style,{background:"transparent",border:"0",outline:"0",padding:"0",position:"fixed"}),document.body.appendChild(p);const h=document.createElement("iframe");h.setAttribute("data-testid","porto");const g=["payment",`publickey-credentials-get ${l.origin}`,`publickey-credentials-create ${l.origin}`];Co()||g.push("clipboard-write"),h.setAttribute("allow",g.join("; ")),h.setAttribute("tabindex","0"),h.setAttribute("sandbox","allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"),h.setAttribute("src",un(i)),h.setAttribute("title","Porto"),Object.assign(h.style,{backgroundColor:"transparent",border:"0",colorScheme:"light dark",height:"100%",left:"0",position:"fixed",top:"0",width:"100%"});const y=document.createElement("style");y.innerHTML=`
        dialog[data-porto]::backdrop {
          background: transparent!important;
        }
      `,p.appendChild(y),p.appendChild(h);const m=$r({from:zt(window,{targetOrigin:l.origin}),to:zt(h.contentWindow,{targetOrigin:l.origin}),waitForReady:!0});c==null||c._setup(m,!0);const k=window.matchMedia("(max-width: 460px)"),A=()=>{m.send("__internal",{type:"resize",width:k.matches?460:461})};k.addEventListener("change",A),m.on("ready",M=>{let j=s.internal.store.getState().chainIds.filter(N=>M.chainIds.includes(N));j.length===0&&(j=M.chainIds),o.setState(N=>({...N,chainIds:j})),m.send("__internal",{chainIds:j,mode:"iframe",referrer:Mt(),theme:u,type:"init"}),A()}),m.on("rpc-response",M=>{if(r([M._request])){const x=h.src;h.src=x}qr(o,M)}),m.on("__internal",M=>{M.type==="switch"&&M.mode==="popup"&&(d.open(),d.syncRequests(o.getState().requestQueue))});let z=null,O=null;const P=()=>Ot(o),T=M=>{M.key==="Escape"&&Ot(o)},U=new MutationObserver(M=>{for(const x of M){if(x.type!=="attributes")continue;const j=x.attributeName;j&&j==="inert"&&p.removeAttribute(j)}});U.observe(p,{attributeOldValue:!0,attributes:!0});let $=!1;const b=()=>{$&&($=!1,p.removeEventListener("click",P),document.removeEventListener("keydown",T),p.style.pointerEvents="none",O==null||O.focus(),O=null,Object.assign(document.body.style,z??""),document.body.style.overflow=(z==null?void 0:z.overflow)??"")},I=()=>{$||($=!0,p.addEventListener("click",P),document.addEventListener("keydown",T),h.focus(),p.style.pointerEvents="auto",z=Object.assign({},document.body.style),document.body.style.overflow="hidden")};let w=!1;const v=()=>{w||(w=!0,document.activeElement instanceof HTMLElement&&(O=document.activeElement),p.removeAttribute("hidden"),p.removeAttribute("aria-closed"),p.showModal())},E=()=>{if(w){w=!1,p.setAttribute("hidden","true"),p.setAttribute("aria-closed","true"),p.close();for(const M of p.parentNode?Array.from(p.parentNode.children):[])M!==p&&M.hasAttribute("inert")&&M.removeAttribute("inert")}};return{close(){d.close(),f=!1,m.send("__internal",{mode:"iframe",referrer:Mt(),type:"init"}),E(),b()},destroy(){d.close(),f=!1,b(),E(),d.destroy(),m.destroy(),p.remove(),U.disconnect(),k.removeEventListener("change",A)},open(){f||(f=!0,v(),I(),m.send("__internal",{mode:"iframe",referrer:Mt(),type:"init"}))},async secure(){const{trustedHosts:M}=await m.waitForReady(),x=(()=>{if(t)return!0;const R=window.location.protocol.startsWith("https");return R||Gn.warnOnce("Detected insecure protocol (HTTP).",`

The Porto iframe is not supported on HTTP origins (${window.location.origin})`,"due to lack of WebAuthn support.","See https://porto.sh/sdk#secure-origins-https for more information."),R})(),j=zo(),N=!!(M!=null&&M.includes(window.location.hostname)),D=!!(j||N);return D||Gn.warnOnce([`Warning: Browser does not support IntersectionObserver v2 or host "${l.hostname}" is not trusted by Porto.`,"This may result in the dialog falling back to a popup.","",`Add "${l.hostname}" to the trusted hosts list to enable iframe dialog: https://github.com/ithacaxyz/porto/edit/main/src/trusted-hosts.ts`].join(`
`)),{frame:D,host:N,protocol:x}},async syncRequests(M){const{methodPolicies:x}=await m.waitForReady(),j=await this.secure(),N=M==null?void 0:M.every(R=>{var q,B;return((B=(q=x==null?void 0:x.find(S=>S.method===R.request.method))==null?void 0:q.modes)==null?void 0:B.headless)===!0}),D=r(M.map(R=>R.request));if(!N&&(D||!j.protocol||!j.frame))d.syncRequests(M);else{const R=M.some(q=>Lr(q.request,{methodPolicies:x,targetOrigin:l.origin}));!f&&R&&this.open(),m.send("rpc-requests",M)}}}},supportsHeadless:!0}}function _o(e={}){if(typeof window>"u")return Rr();const{type:t="auto",size:n=$o}=e;return{name:"popup",setup(r){const{host:s,internal:i,themeController:a}=r,{store:u}=i,c=new URL(s);let o=null;const d=t==="page"||t==="auto"&&To()?"page":"popup";function f(){o&&Ot(u)}const l=(()=>{const h=setInterval(()=>{o!=null&&o.closed&&Ot(u)},100);return()=>clearInterval(h)})();let p;return a==null||a._setup(null,!0),{close(){o&&(o.close(),o=null)},destroy(){this.close(),window.removeEventListener("focus",f),p==null||p.destroy(),l()},open(){if(d==="popup"){const h=(window.innerWidth-n.width)/2+window.screenX,g=window.screenY+100;o=window.open(un(s),"_blank",`width=${n.width},height=${n.height},left=${h},top=${g}`)}else o=window.open(un(s),"_blank");if(!o)throw new Error("Failed to open popup");p=$r({from:zt(window,{targetOrigin:c.origin}),to:zt(o,{targetOrigin:c.origin}),waitForReady:!0}),a==null||a._setup(p,!1),p.send("__internal",{mode:d==="page"?"page":"popup",referrer:Mt(),theme:(a==null?void 0:a.getTheme())??r.theme,type:"init"}),p.on("rpc-response",h=>qr(u,h)),window.removeEventListener("focus",f),window.addEventListener("focus",f)},async secure(){return{frame:!0,host:!0,protocol:!0}},async syncRequests(h){h.some(y=>Lr(y.request))&&((!o||o.closed)&&this.open(),o==null||o.focus()),p==null||p.send("rpc-requests",h)}}},supportsHeadless:!1}}function Rr(){return{name:"noop",setup(){return{close(){},destroy(){},open(){},async secure(){return{frame:!0,host:!0,protocol:!0}},async syncRequests(){}}},supportsHeadless:!0}}const $o={height:282,width:360};function Lr(e,t={}){var i;const{methodPolicies:n,targetOrigin:r}=t,s=n==null?void 0:n.find(a=>a.method===e.method);return s&&(i=s.modes)!=null&&i.headless?!!(typeof s.modes.headless=="object"&&s.modes.headless.sameOrigin&&r!==window.location.origin):!0}function Mt(){return{icon:(()=>{var s,i,a;const t=(s=document.querySelector('link[rel="icon"][media="(prefers-color-scheme: dark)"]'))==null?void 0:s.href,n=((i=document.querySelector('link[rel="icon"][media="(prefers-color-scheme: light)"]'))==null?void 0:i.href)??((a=document.querySelector('link[rel="icon"]'))==null?void 0:a.href);return t&&n&&t!==n?{dark:t,light:n}:window.matchMedia("(prefers-color-scheme: dark)").matches?t:n})(),title:document.title}}function Ot(e){e.setState(t=>({...t,requestQueue:t.requestQueue.map(n=>({account:n.account,error:new Ne,request:n.request,status:"error"}))}))}function qr(e,t){e.setState(n=>({...n,requestQueue:n.requestQueue.map(r=>r.request.id!==t.id?r:t.error?{account:r.account,error:t.error,request:r.request,status:"error"}:{account:r.account,request:r.request,result:t.result,status:"success"})}))}function un(e){const t=new URL(e),n=new URLSearchParams(window.location.search),r="porto.";for(const[s,i]of n.entries())s.startsWith(r)&&t.searchParams.set(s.slice(r.length),i);return t.toString()}function Kr(e,t){if($e(e)>t)throw new Yo({givenSize:$e(e),maxSize:t})}function Uo(e,t){if(typeof t=="number"&&t>0&&t>$e(e)-1)throw new Fr({offset:t,position:"start",size:$e(e)})}function Ro(e,t,n){if(typeof t=="number"&&typeof n=="number"&&$e(e)!==n-t)throw new Fr({offset:n,position:"end",size:$e(e)})}const de={zero:48,nine:57,A:65,F:70,a:97,f:102};function Jn(e){if(e>=de.zero&&e<=de.nine)return e-de.zero;if(e>=de.A&&e<=de.F)return e-(de.A-10);if(e>=de.a&&e<=de.f)return e-(de.a-10)}function Lo(e,t={}){const{dir:n,size:r=32}=t;if(r===0)return e;if(e.length>r)throw new Wo({size:e.length,targetSize:r,type:"Bytes"});const s=new Uint8Array(r);for(let i=0;i<r;i++){const a=n==="right";s[a?i:r-i-1]=e[a?i:e.length-i-1]}return s}const qo=new TextEncoder;function Ko(e){if(!(e instanceof Uint8Array)){if(!e)throw new pt(e);if(typeof e!="object")throw new pt(e);if(!("BYTES_PER_ELEMENT"in e))throw new pt(e);if(e.BYTES_PER_ELEMENT!==1||e.constructor.name!=="Uint8Array")throw new pt(e)}}function Ee(e){return e instanceof Uint8Array?e:typeof e=="string"?ke(e):Br(e)}function Br(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function ke(e,t={}){const{size:n}=t;let r=e;n&&(Gs(e,n),r=Te(e,n));let s=r.slice(2);s.length%2&&(s=`0${s}`);const i=s.length/2,a=new Uint8Array(i);for(let u=0,c=0;u<i;u++){const o=Jn(s.charCodeAt(c++)),d=Jn(s.charCodeAt(c++));if(o===void 0||d===void 0)throw new C(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);a[u]=o<<4|d}return a}function Rt(e,t={}){const{size:n}=t,r=qo.encode(e);return typeof n=="number"?(Kr(r,n),Bo(r,n)):r}function Bo(e,t){return Lo(e,{dir:"right",size:t})}function $e(e){return e.length}function Xn(e,t,n,r={}){const{strict:s}=r;Uo(e,t);const i=e.slice(t,n);return s&&Ro(i,t,n),i}function er(e,t={}){const{size:n}=t;typeof n<"u"&&Kr(e,n);const r=te(e,t);return Nt(r,t)}function kn(e,t={}){return te(e,t)}function Fo(e){try{return Ko(e),!0}catch{return!1}}class pt extends C{constructor(t){super(`Value \`${typeof t=="object"?me(t):t}\` of type \`${typeof t}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class Yo extends C{constructor({givenSize:t,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Fr extends C{constructor({offset:t,position:n,size:r}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${t}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SliceOffsetOutOfBoundsError"})}}class Wo extends C{constructor({size:t,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}class Qo extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const n=super.get(t);return super.has(t)&&n!==void 0&&(this.delete(t),super.set(t,n)),n}set(t,n){if(super.set(t,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Vo={checksum:new Qo(8192)},Ft=Vo.checksum;function H(e,t={}){const{as:n=typeof e=="string"?"Hex":"Bytes"}=t,r=Js(Ee(e));return n==="Bytes"?r:te(r)}function Yr(e,t={}){const{as:n=typeof e=="string"?"Hex":"Bytes"}=t,r=Xs(Ee(e));return n==="Bytes"?r:te(r)}function Wr(e,t={}){const{compressed:n}=t,{prefix:r,x:s,y:i}=e;if(n===!1||typeof s=="bigint"&&typeof i=="bigint"){if(r!==4)throw new tr({prefix:r,cause:new Jo});return}if(n===!0||typeof s=="bigint"&&typeof i>"u"){if(r!==3&&r!==2)throw new tr({prefix:r,cause:new Go});return}throw new Zo({publicKey:e})}function Ue(e){const t=(()=>{if(lt(e))return Lt(e);if(Fo(e))return Ho(e);const{prefix:n,x:r,y:s}=e;return typeof r=="bigint"&&typeof s=="bigint"?{prefix:n??4,x:r,y:s}:{prefix:n,x:r}})();return Wr(t),t}function Ho(e){return Lt(te(e))}function Lt(e){if(e.length!==132&&e.length!==130&&e.length!==68)throw new Xo({publicKey:e});if(e.length===130){const r=BigInt(Q(e,0,32)),s=BigInt(Q(e,32,64));return{prefix:4,x:r,y:s}}if(e.length===132){const r=Number(Q(e,0,1)),s=BigInt(Q(e,1,33)),i=BigInt(Q(e,33,65));return{prefix:r,x:s,y:i}}const t=Number(Q(e,0,1)),n=BigInt(Q(e,1,33));return{prefix:t,x:n}}function Re(e,t={}){Wr(e);const{prefix:n,x:r,y:s}=e,{includePrefix:i=!0}=t;return Z(i?_(n,{size:1}):"0x",_(r,{size:32}),typeof s=="bigint"?_(s,{size:32}):"0x")}class Zo extends C{constructor({publicKey:t}){super(`Value \`${me(t)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class tr extends C{constructor({prefix:t,cause:n}){super(`Prefix "${t}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class Go extends C{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class Jo extends C{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let Xo=class extends C{constructor({publicKey:t}){super(`Value \`${t}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${J(Pe(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const ea=/^0x[a-fA-F0-9]{40}$/;function Ae(e,t={}){const{strict:n=!0}=t;if(!ea.test(e))throw new dn({address:e,cause:new Hr});if(n){if(e.toLowerCase()===e)return;if(Qr(e)!==e)throw new dn({address:e,cause:new ta})}}function Qr(e){if(Ft.has(e))return Ft.get(e);Ae(e,{strict:!1});const t=e.substring(2).toLowerCase(),n=H(Rt(t),{as:"Bytes"}),r=t.split("");for(let i=0;i<40;i+=2)n[i>>1]>>4>=8&&r[i]&&(r[i]=r[i].toUpperCase()),(n[i>>1]&15)>=8&&r[i+1]&&(r[i+1]=r[i+1].toUpperCase());const s=`0x${r.join("")}`;return Ft.set(e,s),s}function Vr(e,t={}){const{checksum:n=!1}=t;return Ae(e),n?Qr(e):e}function An(e,t={}){const n=H(`0x${Re(e).slice(4)}`).substring(26);return Vr(`0x${n}`,t)}function K(e,t){return Ae(e,{strict:!1}),Ae(t,{strict:!1}),e.toLowerCase()===t.toLowerCase()}function je(e,t={}){const{strict:n=!0}=t??{};try{return Ae(e,{strict:n}),!0}catch{return!1}}class dn extends C{constructor({address:t,cause:n}){super(`Address "${t}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Hr extends C{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class ta extends C{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}let Zr=!1;function na(e){const{privateKey:t}=e,n=_t.ProjectivePoint.fromPrivateKey(Pe(t).slice(2));return Ue(n)}function ra(e={}){const{as:t="Hex"}=e,n=_t.utils.randomPrivateKey();return t==="Hex"?te(n):n}function Gr(e){return An(sa(e))}function sa(e){const{payload:t,signature:n}=e,{r,s,yParity:i}=n,u=new _t.Signature(BigInt(r),BigInt(s)).addRecoveryBit(i).recoverPublicKey(Pe(t).substring(2));return Ue(u)}function Jr(e){const{extraEntropy:t=Zr,hash:n,payload:r,privateKey:s}=e,{r:i,s:a,recovery:u}=_t.sign(Ee(r),Ee(s),{extraEntropy:typeof t=="boolean"?t:Pe(t).slice(2),lowS:!0,...n?{prehash:!0}:{}});return{r:i,s:a,yParity:u}}const ia=/^(.*)\[([0-9]*)\]$/,Xr=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,jn=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,nr=2n**256n-1n;function Pn(e,t={}){const{recovered:n}=t;if(typeof e.r>"u")throw new Yt({signature:e});if(typeof e.s>"u")throw new Yt({signature:e});if(n&&typeof e.yParity>"u")throw new Yt({signature:e});if(e.r<0n||e.r>nr)throw new pa({value:e.r});if(e.s<0n||e.s>nr)throw new ha({value:e.s});if(typeof e.yParity=="number"&&e.yParity!==0&&e.yParity!==1)throw new qt({value:e.yParity})}function oa(e){return zn(te(e))}function zn(e){if(e.length!==130&&e.length!==132)throw new fa({signature:e});const t=BigInt(Q(e,0,32)),n=BigInt(Q(e,32,64)),r=(()=>{const s=+`0x${e.slice(130)}`;if(!Number.isNaN(s))try{return On(s)}catch{throw new qt({value:s})}})();return typeof r>"u"?{r:t,s:n}:{r:t,s:n,yParity:r}}function aa(e){if(!(typeof e.r>"u")&&!(typeof e.s>"u"))return es(e)}function es(e){const t=typeof e=="string"?zn(e):e instanceof Uint8Array?oa(e):typeof e.r=="string"?ua(e):e.v?ca(e):{r:e.r,s:e.s,...typeof e.yParity<"u"?{yParity:e.yParity}:{}};return Pn(t),t}function ca(e){return{r:e.r,s:e.s,yParity:On(e.v)}}function ua(e){const t=(()=>{const n=e.v?Number(e.v):void 0;let r=e.yParity?Number(e.yParity):void 0;if(typeof n=="number"&&typeof r!="number"&&(r=On(n)),typeof r!="number")throw new qt({value:e.yParity});return r})();return{r:BigInt(e.r),s:BigInt(e.s),yParity:t}}function vt(e){Pn(e);const t=e.r,n=e.s;return Z(_(t,{size:32}),_(n,{size:32}),typeof e.yParity=="number"?_(la(e.yParity),{size:1}):"0x")}function da(e){const{r:t,s:n,yParity:r}=e;return[r?"0x01":"0x",t===0n?"0x":Rn(_(t)),n===0n?"0x":Rn(_(n))]}function On(e){if(e===0||e===27)return 0;if(e===1||e===28)return 1;if(e>=35)return e%2===0?1:0;throw new ya({value:e})}function la(e){if(e===0)return 27;if(e===1)return 28;throw new qt({value:e})}class fa extends C{constructor({signature:t}){super(`Value \`${t}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${J(Pe(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class Yt extends C{constructor({signature:t}){super(`Signature \`${me(t)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class pa extends C{constructor({value:t}){super(`Value \`${t}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class ha extends C{constructor({value:t}){super(`Value \`${t}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class qt extends C{constructor({value:t}){super(`Value \`${t}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class ya extends C{constructor({value:t}){super(`Value \`${t}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function ma({checksumAddress:e,parameters:t,values:n}){const r=[];for(let s=0;s<t.length;s++)r.push(Dn({checksumAddress:e,parameter:t[s],value:n[s]}));return r}function Dn({checksumAddress:e=!1,parameter:t,value:n}){const r=t,s=Ea(r.type);if(s){const[i,a]=s;return wa(n,{checksumAddress:e,length:i,parameter:{...r,type:a}})}if(r.type==="tuple")return xa(n,{checksumAddress:e,parameter:r});if(r.type==="address")return ga(n,{checksum:e});if(r.type==="bool")return Ia(n);if(r.type.startsWith("uint")||r.type.startsWith("int")){const i=r.type.startsWith("int"),[,,a="256"]=jn.exec(r.type)??[];return Ma(n,{signed:i,size:Number(a)})}if(r.type.startsWith("bytes"))return ba(n,{type:r.type});if(r.type==="string")return va(n);throw new ss(r.type)}function Cn(e){let t=0;for(let i=0;i<e.length;i++){const{dynamic:a,encoded:u}=e[i];a?t+=32:t+=J(u)}const n=[],r=[];let s=0;for(let i=0;i<e.length;i++){const{dynamic:a,encoded:u}=e[i];a?(n.push(_(t+s,{size:32})),r.push(u),s+=J(u)):n.push(u)}return Z(...n,...r)}function ga(e,t){const{checksum:n=!1}=t;return Ae(e,{strict:n}),{dynamic:!1,encoded:Se(e.toLowerCase())}}function wa(e,t){const{checksumAddress:n,length:r,parameter:s}=t,i=r===null;if(!Array.isArray(e))throw new Oa(e);if(!i&&e.length!==r)throw new za({expectedLength:r,givenLength:e.length,type:`${s.type}[${r}]`});let a=!1;const u=[];for(let c=0;c<e.length;c++){const o=Dn({checksumAddress:n,parameter:s,value:e[c]});o.dynamic&&(a=!0),u.push(o)}if(i||a){const c=Cn(u);if(i){const o=_(u.length,{size:32});return{dynamic:!0,encoded:u.length>0?Z(o,c):o}}if(a)return{dynamic:!0,encoded:c}}return{dynamic:!1,encoded:Z(...u.map(({encoded:c})=>c))}}function ba(e,{type:t}){const[,n]=t.split("bytes"),r=J(e);if(!n){let s=e;return r%32!==0&&(s=Te(s,Math.ceil((e.length-2)/2/32)*32)),{dynamic:!0,encoded:Z(Se(_(r,{size:32})),s)}}if(r!==Number.parseInt(n,10))throw new ns({expectedSize:Number.parseInt(n,10),value:e});return{dynamic:!1,encoded:Te(e)}}function Ia(e){if(typeof e!="boolean")throw new C(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:Se(xr(e))}}function Ma(e,{signed:t,size:n}){if(typeof n=="number"){const r=2n**(BigInt(n)-(t?1n:0n))-1n,s=t?-r-1n:0n;if(e>r||e<s)throw new ei({max:r.toString(),min:s.toString(),signed:t,size:n/8,value:e.toString()})}return{dynamic:!1,encoded:_(e,{size:32,signed:t})}}function va(e){const t=se(e),n=Math.ceil(J(t)/32),r=[];for(let s=0;s<n;s++)r.push(Te(Q(t,s*32,(s+1)*32)));return{dynamic:!0,encoded:Z(Te(_(J(t),{size:32})),...r)}}function xa(e,t){const{checksumAddress:n,parameter:r}=t;let s=!1;const i=[];for(let a=0;a<r.components.length;a++){const u=r.components[a],c=Array.isArray(e)?a:u.name,o=Dn({checksumAddress:n,parameter:u,value:e[c]});i.push(o),o.dynamic&&(s=!0)}return{dynamic:s,encoded:s?Cn(i):Z(...i.map(({encoded:a})=>a))}}function Ea(e){const t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}const ka={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new Pa({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(e){if(e<0||e>this.bytes.length-1)throw new ja({length:this.bytes.length,position:e})},decrementPosition(e){if(e<0)throw new rr({offset:e});const t=this.position-e;this.assertPosition(t),this.position=t},getReadCount(e){return this.positionReadCount.get(e||this.position)||0},incrementPosition(e){if(e<0)throw new rr({offset:e});const t=this.position+e;this.assertPosition(t),this.position=t},inspectByte(e){const t=e??this.position;return this.assertPosition(t),this.bytes[t]},inspectBytes(e,t){const n=t??this.position;return this.assertPosition(n+e-1),this.bytes.subarray(n,n+e)},inspectUint8(e){const t=e??this.position;return this.assertPosition(t),this.bytes[t]},inspectUint16(e){const t=e??this.position;return this.assertPosition(t+1),this.dataView.getUint16(t)},inspectUint24(e){const t=e??this.position;return this.assertPosition(t+2),(this.dataView.getUint16(t)<<8)+this.dataView.getUint8(t+2)},inspectUint32(e){const t=e??this.position;return this.assertPosition(t+3),this.dataView.getUint32(t)},pushByte(e){this.assertPosition(this.position),this.bytes[this.position]=e,this.position++},pushBytes(e){this.assertPosition(this.position+e.length-1),this.bytes.set(e,this.position),this.position+=e.length},pushUint8(e){this.assertPosition(this.position),this.bytes[this.position]=e,this.position++},pushUint16(e){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,e),this.position+=2},pushUint24(e){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,e>>8),this.dataView.setUint8(this.position+2,e&255),this.position+=3},pushUint32(e){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,e),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const e=this.inspectByte();return this.position++,e},readBytes(e,t){this.assertReadLimit(),this._touch();const n=this.inspectBytes(e);return this.position+=t??e,n},readUint8(){this.assertReadLimit(),this._touch();const e=this.inspectUint8();return this.position+=1,e},readUint16(){this.assertReadLimit(),this._touch();const e=this.inspectUint16();return this.position+=2,e},readUint24(){this.assertReadLimit(),this._touch();const e=this.inspectUint24();return this.position+=3,e},readUint32(){this.assertReadLimit(),this._touch();const e=this.inspectUint32();return this.position+=4,e},get remaining(){return this.bytes.length-this.position},setPosition(e){const t=this.position;return this.assertPosition(e),this.position=e,()=>this.position=t},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const e=this.getReadCount();this.positionReadCount.set(this.position,e+1),e>0&&this.recursiveReadCount++}};function Aa(e,{recursiveReadLimit:t=8192}={}){const n=Object.create(ka);return n.bytes=e,n.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),n.positionReadCount=new Map,n.recursiveReadLimit=t,n}class rr extends C{constructor({offset:t}){super(`Offset \`${t}\` cannot be negative.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.NegativeOffsetError"})}}class ja extends C{constructor({length:t,position:n}){super(`Position \`${n}\` is out of bounds (\`0 < position < ${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.PositionOutOfBoundsError"})}}class Pa extends C{constructor({count:t,limit:n}){super(`Recursive read limit of \`${n}\` exceeded (recursive read count: \`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.RecursiveReadLimitExceededError"})}}function Le(e,t,n){const{checksumAddress:r=!1}={};if(e.length!==t.length)throw new rs({expectedLength:e.length,givenLength:t.length});const s=ma({checksumAddress:r,parameters:e,values:t}),i=Cn(s);return i.length===0?"0x":i}function Dt(e,t){if(e.length!==t.length)throw new rs({expectedLength:e.length,givenLength:t.length});const n=[];for(let r=0;r<e.length;r++){const s=e[r],i=t[r];n.push(Dt.encode(s,i))}return Z(...n)}(function(e){function t(n,r,s=!1){if(n==="address"){const c=r;return Ae(c),Se(c.toLowerCase(),s?32:0)}if(n==="string")return se(r);if(n==="bytes")return r;if(n==="bool")return Se(xr(r),s?32:1);const i=n.match(jn);if(i){const[c,o,d="256"]=i,f=Number.parseInt(d,10)/8;return _(r,{size:s?32:f,signed:o==="int"})}const a=n.match(Xr);if(a){const[c,o]=a;if(Number.parseInt(o,10)!==(r.length-2)/2)throw new ns({expectedSize:Number.parseInt(o,10),value:r});return Te(r,s?32:0)}const u=n.match(ia);if(u&&Array.isArray(r)){const[c,o]=u,d=[];for(let f=0;f<r.length;f++)d.push(t(o,r[f],!0));return d.length===0?"0x":Z(...d)}throw new ss(n)}e.encode=t})(Dt||(Dt={}));function ts(e){return Array.isArray(e)&&typeof e[0]=="string"?Ln(e):typeof e=="string"?Ln(e):e}class za extends C{constructor({expectedLength:t,givenLength:n,type:r}){super(`Array length mismatch for type \`${r}\`. Expected: \`${t}\`. Given: \`${n}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}}let ns=class extends C{constructor({expectedSize:t,value:n}){super(`Size of bytes "${n}" (bytes${J(n)}) does not match expected size (bytes${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}};class rs extends C{constructor({expectedLength:t,givenLength:n}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${t}`,`Given length (values): ${n}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class Oa extends C{constructor(t){super(`Value \`${t}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}}class ss extends C{constructor(t){super(`Type \`${t}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}function Da(e){const{domain:t,message:n,primaryType:r,types:s}=e,i=(a,u)=>{for(const c of a){const{name:o,type:d}=c,f=u[o],l=d.match(jn);if(l&&(typeof f=="number"||typeof f=="bigint")){const[,g,y]=l;_(f,{signed:g==="int",size:Number.parseInt(y??"",10)/8})}if(d==="address"&&typeof f=="string"&&!je(f))throw new dn({address:f,cause:new Hr});const p=d.match(Xr);if(p){const[,g]=p;if(g&&J(f)!==Number.parseInt(g,10))throw new Na({expectedSize:Number.parseInt(g,10),givenSize:J(f)})}const h=s[d];h&&(La(d),i(h,f))}};if(s.EIP712Domain&&t){if(typeof t!="object")throw new _a({domain:t});i(s.EIP712Domain,t)}if(r!=="EIP712Domain")if(s[r])i(s[r],n);else throw new $a({primaryType:r,types:s})}function Ca(e){const{domain:t={},message:n,primaryType:r}=e,s={EIP712Domain:is(t),...e.types};Da({domain:t,message:n,primaryType:r,types:s});const i=["0x19","0x01"];return t&&i.push(Sa({domain:t,types:s})),r!=="EIP712Domain"&&i.push(os({data:n,primaryType:r,types:s})),Z(...i)}function Ta(e){const{primaryType:t,types:n}=e;let r="";const s=us({primaryType:t,types:n});s.delete(t);const i=[t,...Array.from(s).sort()];for(const a of i)r+=`${a}(${(n[a]??[]).map(({name:u,type:c})=>`${c} ${u}`).join(",")})`;return r}function is(e){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},(typeof(e==null?void 0:e.chainId)=="number"||typeof(e==null?void 0:e.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function Tn(e){return H(Ca(e))}function Sa(e){const{domain:t,types:n}=e;return os({data:t,primaryType:"EIP712Domain",types:{...n,EIP712Domain:(n==null?void 0:n.EIP712Domain)||is(t)}})}function os(e){const{data:t,primaryType:n,types:r}=e,s=as({data:t,primaryType:n,types:r});return H(s)}class Na extends C{constructor({expectedSize:t,givenSize:n}){super(`Expected bytes${t}, got bytes${n}.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.BytesSizeMismatchError"})}}class _a extends C{constructor({domain:t}){super(`Invalid domain "${me(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidDomainError"})}}class $a extends C{constructor({primaryType:t,types:n}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(n))}\`.`,{metaMessages:["Check that the primary type is a key in `types`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidPrimaryTypeError"})}}class Ua extends C{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidStructTypeError"})}}function as(e){const{data:t,primaryType:n,types:r}=e,s=[{type:"bytes32"}],i=[Ra({primaryType:n,types:r})];for(const a of r[n]??[]){const[u,c]=cs({types:r,name:a.name,type:a.type,value:t[a.name]});s.push(u),i.push(c)}return Le(s,i)}function Ra(e){const{primaryType:t,types:n}=e,r=se(Ta({primaryType:t,types:n}));return H(r)}function cs(e){let{types:t,name:n,type:r,value:s}=e;if(t[r]!==void 0)return[{type:"bytes32"},H(as({data:s,primaryType:r,types:t}))];if(r==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},H(s,{as:"Hex"})];if(r==="string")return[{type:"bytes32"},H(Rt(s),{as:"Hex"})];if(r.lastIndexOf("]")===r.length-1){const i=r.slice(0,r.lastIndexOf("[")),a=s.map(u=>cs({name:n,type:i,types:t,value:u}));return[{type:"bytes32"},H(Le(a.map(([u])=>u),a.map(([,u])=>u)))]}return[{type:r},s]}function us(e,t=new Set){const{primaryType:n,types:r}=e,s=n.match(/^\w*/u),i=s==null?void 0:s[0];if(t.has(i)||r[i]===void 0)return t;t.add(i);for(const a of r[i])us({primaryType:a.type,types:r},t);return t}function La(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new Ua({type:e})}function ln(e){let t=!0,n="",r=0,s="",i=!1;for(let a=0;a<e.length;a++){const u=e[a];if(["(",")",","].includes(u)&&(t=!0),u==="("&&r++,u===")"&&r--,!!t){if(r===0){if(u===" "&&["event","function","error",""].includes(s))s="";else if(s+=u,u===")"){i=!0;break}continue}if(u===" "){e[a-1]!==","&&n!==","&&n!==",("&&(n="",t=!1);continue}s+=u,n+=u}}if(!i)throw new C("Unable to normalize signature.");return s}function fn(e,t){const n=typeof e,r=t.type;switch(r){case"address":return je(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in t?Object.values(t.components).every((s,i)=>fn(Object.values(e)[i],s)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(e)&&e.every(s=>fn(s,{...t,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function ds(e,t,n){for(const r in e){const s=e[r],i=t[r];if(s.type==="tuple"&&i.type==="tuple"&&"components"in s&&"components"in i)return ds(s.components,i.components,n[r]);const a=[s.type,i.type];if(a.includes("address")&&a.includes("bytes20")?!0:a.includes("address")&&a.includes("string")?je(n[r],{strict:!1}):a.includes("address")&&a.includes("bytes")?je(n[r],{strict:!1}):!1)return a}}function qa(e,t={}){const{prepare:n=!0}=t,r=Array.isArray(e)?qn(e):typeof e=="string"?qn(e):e;return{...r,...n?{hash:Ce(r)}:{}}}function ft(e,t,n){const{args:r=[],prepare:s=!0}=n??{},i=lt(t,{strict:!1}),a=e.filter(o=>i?o.type==="function"||o.type==="error"?Sn(o)===Q(t,0,4):o.type==="event"?Ce(o)===t:!1:"name"in o&&o.name===t);if(a.length===0)throw new Ct({name:t});if(a.length===1)return{...a[0],...s?{hash:Ce(a[0])}:{}};let u;for(const o of a){if(!("inputs"in o))continue;if(!r||r.length===0){if(!o.inputs||o.inputs.length===0)return{...o,...s?{hash:Ce(o)}:{}};continue}if(!o.inputs||o.inputs.length===0||o.inputs.length!==r.length)continue;if(r.every((f,l)=>{const p="inputs"in o&&o.inputs[l];return p?fn(f,p):!1})){if(u&&"inputs"in u&&u.inputs){const f=ds(o.inputs,u.inputs,r);if(f)throw new Ba({abiItem:o,type:f[0]},{abiItem:u,type:f[1]})}u=o}}const c=(()=>{if(u)return u;const[o,...d]=a;return{...o,overloads:d}})();if(!c)throw new Ct({name:t});return{...c,...s?{hash:Ce(c)}:{}}}function Sn(...e){const t=(()=>{if(Array.isArray(e[0])){const[n,r]=e;return ft(n,r)}return e[0]})();return Q(Ce(t),0,4)}function Ka(...e){const t=(()=>{if(Array.isArray(e[0])){const[r,s]=e;return ft(r,s)}return e[0]})(),n=typeof t=="string"?t:en(t);return ln(n)}function Ce(...e){const t=(()=>{if(Array.isArray(e[0])){const[n,r]=e;return ft(n,r)}return e[0]})();return typeof t!="string"&&"hash"in t&&t.hash?t.hash:H(se(Ka(t)))}class Ba extends C{constructor(t,n){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${t.type}\` in \`${ln(en(t.abiItem))}\`, and`,`\`${n.type}\` in \`${ln(en(n.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}}class Ct extends C{constructor({name:t,data:n,type:r="item"}){const s=t?` with name "${t}"`:n?` with data "${n}"`:"";super(`ABI ${r}${s} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}}function Fa(...e){const[t,n=[]]=(()=>{if(Array.isArray(e[0])){const[o,d,f]=e;return[pn(o,d,{args:f}),f]}const[u,c]=e;return[u,c]})(),{overloads:r}=t,s=r?pn([t,...r],t.name,{args:n}):t,i=ls(s),a=n.length>0?Le(s.inputs,n):void 0;return a?Z(i,a):i}function pn(e,t,n){const r=ft(e,t,n);if(r.type!=="function")throw new Ct({name:t,type:"function"});return r}function ls(e){return Sn(e)}function fs(e){const{privateKey:t}=e,n=xn.ProjectivePoint.fromPrivateKey(typeof t=="string"?t.slice(2):te(t).slice(2));return Ue(n)}function ps(e={}){const{as:t="Hex"}=e,n=xn.utils.randomPrivateKey();return t==="Hex"?te(n):n}function sr(e){const{extraEntropy:t=Zr,hash:n,payload:r,privateKey:s}=e,{r:i,s:a,recovery:u}=xn.sign(r instanceof Uint8Array?r:ke(r),s instanceof Uint8Array?s:ke(s),{extraEntropy:typeof t=="boolean"?t:Pe(t).slice(2),lowS:!0,...n?{prehash:!0}:{}});return{r:i,s:a,yParity:u}}function hs(e,t=0){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new Ya({value:e});let[n="",r="0"]=e.split(".");const s=n.startsWith("-");if(s&&(n=n.slice(1)),r=r.replace(/(0+)$/,""),t===0)Math.round(+`.${r}`)===1&&(n=`${BigInt(n)+1n}`),r="";else if(r.length>t){const[i,a,u]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],c=Math.round(+`${a}.${u}`);c>9?r=`${BigInt(i)+BigInt(1)}0`.padStart(i.length+1,"0"):r=`${i}${c}`,r.length>t&&(r=r.slice(1),n=`${BigInt(n)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${s?"-":""}${n}${r}`)}class Ya extends C{constructor({value:t}){super(`Value \`${t}\` is not a valid decimal number.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Value.InvalidDecimalNumberError"})}}const Wa=new TextEncoder,Qa=new TextDecoder,ht=Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[t,e.charCodeAt(0)])),yt={...Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[e.charCodeAt(0),t])),61:0,45:62,95:63};function Va(e,t={}){const{pad:n=!0,url:r=!1}=t,s=new Uint8Array(Math.ceil(e.length/3)*4);for(let c=0,o=0;o<e.length;c+=4,o+=3){const d=(e[o]<<16)+(e[o+1]<<8)+(e[o+2]|0);s[c]=ht[d>>18],s[c+1]=ht[d>>12&63],s[c+2]=ht[d>>6&63],s[c+3]=ht[d&63]}const i=e.length%3,a=Math.floor(e.length/3)*4+(i&&i+1);let u=Qa.decode(new Uint8Array(s.buffer,0,a));return n&&i===1&&(u+="=="),n&&i===2&&(u+="="),r&&(u=u.replaceAll("+","-").replaceAll("/","_")),u}function Ha(e,t={}){return Va(ke(e),t)}function hn(e){const t=e.replace(/=+$/,""),n=t.length,r=new Uint8Array(n+3);Wa.encodeInto(t+"===",r);for(let i=0,a=0;i<t.length;i+=4,a+=3){const u=(yt[r[i]]<<18)+(yt[r[i+1]]<<12)+(yt[r[i+2]]<<6)+yt[r[i+3]];r[a]=u>>16,r[a+1]=u>>8&255,r[a+2]=u&255}const s=(n>>2)*3+(n%4&&n%4-1);return new Uint8Array(r.buffer,0,s)}function Za(e){const t=e[4]===0?5:4,n=t+32,r=e[n+2]===0?n+3:n+2,s=BigInt(te(e.slice(t,n))),i=BigInt(te(e.slice(r)));return{r:s,s:i>jt.CURVE.n/2n?jt.CURVE.n-i:i}}async function Ga(e){try{const t=e.getPublicKey();if(!t)throw new Tt;const n=new Uint8Array(t),r=await crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256",hash:"SHA-256"},!0,["verify"]),s=new Uint8Array(await crypto.subtle.exportKey("raw",r));return Ue(s)}catch(t){if(t.message!=="Permission denied to access object")throw t;const n=new Uint8Array(e.attestationObject),r=32,s=88,i=c=>{const o=new Uint8Array([c,s,r]);for(let d=0;d<n.length-o.length;d++)if(o.every((f,l)=>n[d+l]===f))return d+o.length;throw new Tt},a=i(33),u=i(34);return Ue(new Uint8Array([4,...n.slice(a,a+r),...n.slice(u,u+r)]))}}const Ja=Uint8Array.from([105,171,180,181,160,222,75,198,42,42,32,31,141,37,186,233]);async function Xa(e){const{createFn:t=window.navigator.credentials.create.bind(window.navigator.credentials),...n}=e,r=nc(n);try{const s=await t(r);if(!s)throw new Tt;const i=s.response,a=await Ga(i);return{id:s.id,publicKey:a,raw:s}}catch(s){throw new Tt({cause:s})}}function ec(e={}){const{flag:t=5,rpId:n=window.location.hostname,signCount:r=0}=e,s=Yr(se(n)),i=_(t,{size:1}),a=_(r,{size:4});return Z(s,i,a)}function tc(e){const{challenge:t,crossOrigin:n=!1,extraClientData:r,origin:s=window.location.origin}=e;return JSON.stringify({type:"webauthn.get",challenge:Ha(t,{url:!0,pad:!1}),origin:s,crossOrigin:n,...r})}function nc(e){const{attestation:t="none",authenticatorSelection:n={residentKey:"preferred",requireResidentKey:!1,userVerification:"required"},challenge:r=Ja,excludeCredentialIds:s,extensions:i,name:a,rp:u={id:window.location.hostname,name:window.document.title},user:c}=e,o=(c==null?void 0:c.name)??a;return{publicKey:{attestation:t,authenticatorSelection:n,challenge:typeof r=="string"?ke(r):r,...s?{excludeCredentials:s==null?void 0:s.map(d=>({id:hn(d),type:"public-key"}))}:{},pubKeyCredParams:[{type:"public-key",alg:-7}],...i&&{extensions:i},rp:u,user:{id:(c==null?void 0:c.id)??H(Rt(o),{as:"Bytes"}),name:o,displayName:(c==null?void 0:c.displayName)??o}}}}function rc(e){const{credentialId:t,challenge:n,extensions:r,rpId:s=window.location.hostname,userVerification:i="required"}=e;return{publicKey:{...t?{allowCredentials:Array.isArray(t)?t.map(a=>({id:hn(a),type:"public-key"})):[{id:hn(t),type:"public-key"}]}:{},challenge:ke(n),...r&&{extensions:r},rpId:s,userVerification:i}}}function sc(e){const{challenge:t,crossOrigin:n,extraClientData:r,flag:s,origin:i,rpId:a,signCount:u,userVerification:c="required"}=e,o=ec({flag:s,rpId:a,signCount:u}),d=tc({challenge:t,crossOrigin:n,extraClientData:r,origin:i}),f=Yr(se(d)),l=d.indexOf('"challenge"'),p=d.indexOf('"type"'),h={authenticatorData:o,clientDataJSON:d,challengeIndex:l,typeIndex:p,userVerificationRequired:c==="required"},g=Z(o,f);return{metadata:h,payload:g}}async function ys(e){const{getFn:t=window.navigator.credentials.get.bind(window.navigator.credentials),...n}=e,r=rc(n);try{const s=await t(r);if(!s)throw new ir;const i=s.response,a=String.fromCharCode(...new Uint8Array(i.clientDataJSON)),u=a.indexOf('"challenge"'),c=a.indexOf('"type"'),o=Za(new Uint8Array(i.signature));return{metadata:{authenticatorData:te(new Uint8Array(i.authenticatorData)),clientDataJSON:a,challengeIndex:u,typeIndex:c,userVerificationRequired:r.publicKey.userVerification==="required"},signature:o,raw:s}}catch(s){throw new ir({cause:s})}}class Tt extends C{constructor({cause:t}={}){super("Failed to create credential.",{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WebAuthnP256.CredentialCreationFailedError"})}}class ir extends C{constructor({cause:t}={}){super("Failed to request credential.",{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WebAuthnP256.CredentialRequestFailedError"})}}async function ic(e={}){const{extractable:t=!1}=e,n=await globalThis.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},t,["sign","verify"]),r=await globalThis.crypto.subtle.exportKey("raw",n.publicKey),s=Ue(new Uint8Array(r));return{privateKey:n.privateKey,publicKey:s}}async function oc(e){const{payload:t,privateKey:n}=e,r=await globalThis.crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},n,Ee(t)),s=Br(new Uint8Array(r)),i=er(Xn(s,0,32));let a=er(Xn(s,32,64));return a>jt.CURVE.n/2n&&(a=jt.CURVE.n-a),{r:i,s:a}}const ms="0x3232323232323232323232323232323232323232",or="0x32323232",ac={p256:"p256",secp256k1:"secp256k1",webauthnp256:"webauthn-p256"},cc={admin:"admin",normal:"session"},uc={0:"minute",1:"hour",2:"day",3:"week",4:"month",5:"year"},dc={address:"secp256k1",p256:"p256",secp256k1:"secp256k1","webauthn-p256":"webauthnp256"},lc={admin:"admin",session:"normal"},fc={address:2,p256:0,secp256k1:2,"webauthn-p256":1},ar={day:2,hour:1,minute:0,month:4,week:3,year:5};function pc(e={}){const t=ps();return yc({...e,privateKey:t})}async function cr(e){const{createFn:t,label:n,rpId:r,userId:s}=e,i=await Xa({authenticatorSelection:{requireResidentKey:!0,residentKey:"required",userVerification:"required"},createFn:t,extensions:{credProps:!0},rp:r?{id:r,name:r}:void 0,user:{displayName:n,id:new Uint8Array(s??Rt(n)),name:n}});return gs({...e,credential:{id:i.id,publicKey:i.publicKey},id:s?kn(s):Re(i.publicKey,{includePrefix:!1})})}function ur(e={}){const t=ps();return gc({...e,privateKey:t})}async function hc(e={}){const t=await ic();return wc({...e,keyPair:t})}function ie(e,t={}){const{chainId:n=e.chainId}=t,{expiry:r=0,id:s,prehash:i=!1,role:a="admin",type:u}=e,c=(()=>{const o=e.publicKey;return o==="0x"?o:u==="secp256k1"||u==="address"?J(o)===20||Nt(Q(o,0,12))===0n?Q(o,-20):An(Lt(o)):o})();return{...e,chainId:n,expiry:r,hash:ws({publicKey:c,type:u}),id:(s??c).toLowerCase(),prehash:i,publicKey:c.toLowerCase(),role:a,type:u}}function yc(e){const{chainId:t,expiry:n,feeToken:r,permissions:s,privateKey:i,role:a}=e,u=Re(fs({privateKey:i}),{includePrefix:!1});return ie({chainId:t,expiry:n,feeToken:r,permissions:s,privateKey(){return i},publicKey:u,role:a,type:"p256"})}function mc(e,t){const{chainId:n}=t,{publicKey:r}=e,s=J(r)===20||Nt(Q(r,0,12))===0n,i={};for(const a of e.permissions)a.type==="call"&&(i.calls??(i.calls=[]),i.calls.push({signature:a.selector,to:a.to===ms?void 0:a.to})),a.type==="spend"&&(i.spend??(i.spend=[]),i.spend.push({limit:a.limit,period:a.period,token:a.token}));return ie({chainId:n,expiry:e.expiry,permissions:i,publicKey:e.publicKey,role:cc[e.role],type:s?"address":ac[e.type]})}function gs(e){const{credential:t,id:n,rpId:r}=e,s=Re(t.publicKey,{includePrefix:!1});return ie({chainId:e.chainId,expiry:e.expiry??0,feeToken:e.feeToken,id:n,permissions:e.permissions,privateKey:{credential:t,rpId:r},publicKey:s,role:e.role,type:"webauthn-p256"})}function gc(e){const{privateKey:t}=e,n=Re(fs({privateKey:t}),{includePrefix:!1});return ie({chainId:e.chainId,expiry:e.expiry??0,feeToken:e.feeToken,permissions:e.permissions,privateKey:{privateKey(){return t}},publicKey:n,role:e.role,type:"webauthn-p256"})}function wc(e){const{chainId:t,expiry:n,feeToken:r,keyPair:s,permissions:i,role:a}=e,{privateKey:u}=s,c=Re(s.publicKey,{includePrefix:!1});return ie({chainId:t,expiry:n,feeToken:r,permissions:i,prehash:!0,privateKey:u,publicKey:c,role:a,type:"p256"})}function ws(e){const{type:t}=e,n=bs(e.publicKey);return H(Le([{type:"uint8"},{type:"bytes32"}],[fc[t],H(n)]))}function bs(e){return J(e)<32?Se(e,32):e}async function Ie(e,t){const{address:n,storage:r,webAuthn:s,wrap:i=!0}=t,{privateKey:a,publicKey:u,type:c}=e;if(!a)throw new Error(`Key does not have a private key to sign with.

Key:
`+me(e,null,2));const o=n?Tn({domain:{verifyingContract:n},message:{digest:t.payload},primaryType:"ERC1271Sign",types:{ERC1271Sign:[{name:"digest",type:"bytes32"}]}}):t.payload,[d,f]=await(async()=>{if(c==="p256"){const{privateKey:l}=e;if(typeof l=="function")return[vt(sr({payload:o,privateKey:l()})),!1];if(l instanceof CryptoKey)return[vt(await oc({payload:o,privateKey:l})),!0]}if(c==="secp256k1")return[vt(Jr({payload:o,privateKey:a()})),!1];if(c==="webauthn-p256"){if(a.privateKey){const{payload:$,metadata:b}=sc({challenge:o,origin:"https://ithaca.xyz",rpId:"ithaca.xyz"}),{r:I,s:w}=sr({hash:!0,payload:$,privateKey:a.privateKey()});return[yn({metadata:b,signature:{r:I,s:w}}),!1]}const{credential:l,rpId:p}=a,h=`porto.webauthnVerified.${e.hash}`,g=Date.now(),y=600*1e3;let m=!0;if(r){const $=await r.getItem(h);m=!$||g-$>y}const{signature:{r:k,s:A},raw:z,metadata:O}=await ys({challenge:o,credentialId:l.id,getFn:s==null?void 0:s.getFn,rpId:p,userVerification:m?"required":"preferred"}),P=z.response;if(!(P!=null&&P.userHandle))throw new Error("No user handle in response",{cause:{response:P}});const T=kn(new Uint8Array(P.userHandle));if(e.id&&je(e.id)&&!K(e.id,T))throw new Error(`supplied webauthn key "${e.id}" does not match signature webauthn key "${T}"`,{cause:{id:T,key:e}});return m&&r&&await r.setItem(h,g),[yn({metadata:O,signature:{r:k,s:A}}),!1]}throw new Error(`Key type "${c}" is not supported.

Key:
`+me(e,null,2))})();return i?Ms(d,{keyType:c,prehash:f,publicKey:u}):d}function St(e,t={}){const{expiry:n=0,prehash:r=!1,publicKey:s,role:i="admin",type:a}=e,{feeTokens:u,orchestrator:c}=t,o=Object.entries(Is(e,{feeTokens:u})).map(([d,f])=>{if(d==="calls")return f.map(({signature:p,to:h})=>({selector:p?lt(p)?p:ls(p):or,to:h??ms,type:"call"}));if(d!=="feeToken"){if(d==="spend")return f.map(({limit:p,period:h,token:g})=>({limit:p,period:h,token:g,type:"spend"}));throw new Error(`Invalid permission type "${d}".`)}}).flat().filter(Boolean);return e.role==="session"&&c&&o.push({selector:or,to:c,type:"call"}),{expiry:n,permissions:o??[],prehash:r,publicKey:bs(s),role:lc[i],type:dc[a]}}function Is(e,t){var a;const{permissions:n}=e,r=n!=null&&n.calls?[...n.calls]:[],s=n!=null&&n.spend?[...n.spend]:[],i=(a=t.feeTokens)==null?void 0:a.filter(u=>u.feeToken);if(i&&i.length>0){const u=bc(e,{feeTokens:i});if(u){let c=-1,o=ar.year;for(let d=0;d<s.length;d++){const f=s[d];if(f.token&&K(u.address,f.token)){c=d;break}if(!f.token&&u.address===Xe){c=d;break}const l=ar[f.period];l<o&&(o=l)}c!==-1?(s[c]={...s[c],limit:s[c].limit+u.value},s.unshift(s.splice(c,1)[0])):typeof o=="number"&&s.unshift({limit:u.value,period:uc[o],token:u.address})}}return{...n,calls:r,spend:s}}function bc(e,t){const{feeTokens:n}=t;if(!e.feeToken)return;const r=n.find(i=>e.feeToken.symbol===i.symbol?!0:e.feeToken.symbol?e.feeToken.symbol==="native"?i.address===Xe:!1:i.address===Xe);if(!r)return;const s=hs(e.feeToken.limit,r.decimals);return{...r,value:s}}function yn(e){const{metadata:t,signature:n}=e;return Le(ts(["struct WebAuthnAuth { bytes authenticatorData; string clientDataJSON; uint256 challengeIndex; uint256 typeIndex; bytes32 r; bytes32 s; }","WebAuthnAuth auth"]),[{authenticatorData:t.authenticatorData,challengeIndex:BigInt(t.challengeIndex),clientDataJSON:t.clientDataJSON,r:_(n.r,{size:32}),s:_(n.s,{size:32}),typeIndex:BigInt(t.typeIndex)}])}function Ms(e,t){const{keyType:n,prehash:r=!1,publicKey:s}=t,i=ws({publicKey:s,type:n});return Dt(["bytes","bytes32","bool"],[e,i,r])}function ne(e){const t=typeof e=="string"?{address:e}:e,n=t.sign?"privateKey":"porto",{address:r,sign:s,signMessage:i,signTransaction:a,signTypedData:u,type:c}=ti({address:t.address,sign({hash:o}){if(n==="porto")throw new Error("`sign` not supported on porto accounts.");if(!t.sign)throw new Error("`sign` not supported.");return t.sign({hash:o})},signMessage({message:o}){return this.sign({hash:ri(o)})},signTransaction(){throw new Error("`signTransaction` not supported on porto accounts.")},signTypedData(o){return this.sign({hash:ni(o)})}});return{address:r,keys:t.keys??void 0,sign:s,signMessage:i,signTransaction:a,signTypedData:u,source:n,type:c}}function Ic(e,t={}){const{keys:n}=t,r=An(na({privateKey:e}));return ne({address:r,keys:n,async sign({hash:s}){return vt(Jr({payload:s,privateKey:e}))},source:"privateKey"})}function Kt(e,t={}){const{key:n,role:r}=t;if(n!==null){if(typeof n=="object")return n;if(e.keys&&e.keys.length>0)return typeof n=="number"?e.keys[n]:e.keys.find(s=>s.privateKey&&(!r||s.role===r))}}async function Fe(e,t){const{storage:n,replaySafe:r=!0,wrap:s=!0,webAuthn:i}=t,a=Kt(e,t),u=r?Tn({domain:{verifyingContract:e.address},message:{digest:t.payload},primaryType:"ERC1271Sign",types:{ERC1271Sign:[{name:"digest",type:"bytes32"}]}}):t.payload,c=a?({hash:o})=>Ie(a,{address:null,payload:o,storage:n,webAuthn:i,wrap:s}):e.source==="privateKey"?e.sign:void 0;if(!c)throw new Error("cannot find key to sign with.");return await c({hash:u})}function Nn(e,t={}){return qa(e,t)}function Mc(e,t,n){if(t==="Error")return dr;if(t==="Panic")return lr;if(lt(t,{strict:!1})){const s=Q(t,0,4);if(s===vc)return dr;if(s===xc)return lr}const r=ft(e,t,n);if(r.type!=="error")throw new Ct({name:t,type:"error"});return r}const dr=Nn({inputs:[{name:"message",type:"string"}],name:"Error",type:"error"}),vc="0x08c379a0",lr=Nn({inputs:[{name:"reason",type:"uint8"}],name:"Panic",type:"error"}),xc="0x4e487b71";class Ec extends Ze{constructor(){super("Function is not recognized.",{metaMessages:["This could be due to any of the following:","  - The contract does not have the function,","  - The address is not a contract."],name:"FunctionSelectorNotRecognizedError"})}}function kc(e,t){const n=e.walk(s=>"data"in s);if(!(n!=null&&n.data))return e;if(n.data===Xi(Ji("error FnSelectorNotRecognized()")))return new Ec;let r=null;for(const s of t.calls){const i=s;if(i.abi)try{if(!!!si({abi:i.abi,data:n.data}))continue;r=i}catch{}}return r?ii(n,{abi:r.abi,address:r.to,args:r.args,functionName:r.functionName}):e}async function Ac(e,t){try{const n="wallet_getAuthorization",r=await $t(()=>e.request({method:n,params:[L(Yn.Parameters,t)]}),{cacheKey:`${e.uid}.${n}.${t.address}`});return V(Yn.Response,r)}catch(n){throw ae(n),n}}async function ut(e,t={}){const n=(()=>{if(t.chainId)return[t.chainId];if(t.chainIds!=="all")return t.chainIds?t.chainIds:[e.chain.id]})();try{const r="wallet_getCapabilities",s=await $t(()=>e.request({method:r,params:n?[n]:void 0},{retryCount:0}),{cacheKey:`${e.uid}.${r}.${n==null?void 0:n.join(",")}`}),i=t.raw?s:V(ai.Response,s);return t.chainIds?i:Object.values(i)[0]}catch(r){throw ae(r),r}}async function jc(e,t){var a;const{account:n,assetFilter:r,assetTypeFilter:s,chainFilter:i}=t;try{const c=await e.request({method:"wallet_getAssets",params:[L(Bn.Parameters,{account:n,assetFilter:r,assetTypeFilter:s,chainFilter:i})]}),o=V(Bn.Response,c),d=Object.entries(o).reduce((l,[p,h])=>(l[Ge(p)]=h,l),{}),f={};for(const l of Object.values(d))for(const p of l){const h=JSON.stringify(p.metadata);f[h]={...p,balance:p.balance+(((a=f[h])==null?void 0:a.balance)??0n)}}return{...d,0:Object.values(f)}}catch(u){throw ae(u),u}}async function Pc(e,t){const{id:n}=t;try{const s=await e.request({method:"wallet_getCallsStatus",params:[n]});return V(ci.Response,s)}catch(r){throw ae(r),r}}async function zc(e,t){const{address:n,chainIds:r}=t;try{const i=await e.request({method:"wallet_getKeys",params:[L(Hn.Parameters,{address:n,chainIds:r})]});return V(Hn.Response,i)}catch(s){throw ae(s),s}}async function Oc(e){const t="health",n=await $t(()=>e.request({method:t}),{cacheKey:`${e.uid}.${t}`});return V(di.Response,n)}async function Wt(e,t){const{address:n,capabilities:r,chain:s=e.chain,key:i}=t,a=t.calls.map(u=>({data:u.abi?Fa(pn(u.abi,u.functionName),u.args):u.data??"0x",to:u.to,value:u.value??0n}));try{const c=await e.request({method:"wallet_prepareCalls",params:[L(Vn.Parameters,{calls:a,capabilities:{...r,meta:{...r==null?void 0:r.meta}},chainId:s==null?void 0:s.id,from:n,key:i?{prehash:i.prehash,publicKey:i.publicKey,type:i.type}:void 0})]},{retryCount:0});return Object.assign(V(Vn.Response,c),{_raw:c})}catch(u){throw ae(u),qe(u,{calls:t.calls}),u}}async function Dc(e,t){const{address:n,chain:r=e.chain,delegation:s,...i}=t;try{const u=await e.request({method:"wallet_prepareUpgradeAccount",params:[L(Qn.Parameters,_e({address:n,capabilities:i,chainId:r==null?void 0:r.id,delegation:s}))]},{retryCount:0});return V(Qn.Response,u)}catch(a){throw ae(a),qe(a),a}}async function Cc(e,t){const{capabilities:n,context:r,key:s,signature:i}=t;try{const u=await e.request({method:"wallet_sendPreparedCalls",params:[L(Wn.Parameters,{capabilities:n,context:{preCall:r.preCall,quote:r.quote},key:s?{prehash:s.prehash,publicKey:s.publicKey,type:s.type}:void 0,signature:i})]},{retryCount:0});return V(Wn.Response,u)}catch(a){throw ae(a),qe(a),a}}async function Tc(e,t){const{email:n,walletAddress:r}=t;try{const i=await e.request({method:"account_setEmail",params:[L(Zn.Parameters,{email:n,walletAddress:r})]},{retryCount:0});return V(Zn.Response,i)}catch(s){throw ae(s),qe(s),s}}async function Sc(e,t){const{context:n,signatures:r}=t;try{await e.request({method:"wallet_upgradeAccount",params:[L(ui.Parameters,{context:n,signatures:r})]},{retryCount:0})}catch(s){throw ae(s),qe(s),s}}async function Nc(e,t){const{chainId:n,email:r,signature:s,token:i,walletAddress:a}=t;try{const c=await e.request({method:"account_verifyEmail",params:[L(Fn.Parameters,{chainId:n,email:r,signature:s,token:i,walletAddress:a})]},{retryCount:0});return V(Fn.Response,c)}catch(u){throw ae(u),qe(u),u}}async function _c(e,t){const{signature:n}=t,{signature:r,capabilities:{feeSignature:s,...i},...a}=t.response,u=mn({capabilities:i,...a}),c=H(se(JSON.stringify(u))),o=Gr({payload:c,signature:zn(n)}),{quoteSigner:d}=await Oc(e);return o===d}async function $c(e,t){const{address:n,chain:r=e.chain,digest:s,signature:i}=t;try{async function a(){return{proof:null,valid:await oi(e,{address:n,hash:s,signature:i})}}const u="wallet_verifySignature",c=await(async()=>{const o=await e.request({method:u,params:[L(Kn.Parameters,{address:n,chainId:r==null?void 0:r.id,digest:s,signature:i})]},{retryCount:0}).catch(a);return o.valid?o:a()})();return V(Kn.Response,c)}catch(a){throw ae(a),a}}function qe(e,{calls:t}={}){if(!(e instanceof Ze))return;const n=i=>{try{if(i.name==="ContractFunctionExecutionError"){const o=i.cause.name==="ContractFunctionRevertedError"?i.cause.data:void 0;if(o)return Mc([o.abiItem],o.errorName)}const a=i.walk(o=>!(o instanceof Error)&&o.code===3);if(!a)return;const{data:u,message:c}=a;return u==="0xd0d5039b"?Nn("error Unauthorized()"):{inputs:[],name:(c??u).split("(")[0],type:"error"}}catch{return}},r=kc(e,{calls:t??[]}),s=n(r);if(!(r===e&&!s))throw new Uc(Object.assign(r,{abiError:s}))}function mn(e){if(typeof e=="object"&&e!==null){if(Array.isArray(e))return e.map(mn);const t={};for(const n of Object.keys(e).sort())t[n]=mn(e[n]);return t}return e}function ae(e){if(e.name==="$ZodError")throw Er(e)}class Uc extends C{constructor(t){super("An error occurred while executing calls.",{cause:t,metaMessages:[t.abiError&&"Reason: "+t.abiError.name].filter(Boolean)}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Rpc.ExecutionError"}),Object.defineProperty(this,"abiError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiError=t.abiError}}const Rc={prod:{http:"https://rpc.porto.sh"}};function dt(e){return t=>{const n=e.public(t),r=e.relay(t);return li({key:dt.type,name:"Relay Proxy",async request({method:s,params:i},a){return Lc(s)?r.request({method:s,params:i},a):n.request({method:s,params:i},a)},type:dt.type})}}(function(e){e.type="relayProxy"})(dt||(dt={}));function Lc(e){return!!(e.startsWith("wallet_")||e.startsWith("account_")||e==="health")}const Qt=new Map;function qc(e,t={}){const{config:n,id:r,store:s}=e._internal,{chains:i,relay:a}=n,u=s.getState(),c=t.chainId??u.chainIds[0],o=i.find(p=>p.id===c);if(!o)throw new Error(["Could not find a compatible Porto chain on the given chain configuration.","",`Provided chains: [${i.map(p=>`${p.name} (id: ${p.id})`).join(", ")}]`,`Needed chain (id): ${c}`,"Please add this chain (id) to your chain configuration."].join(`
`));const d=dt({public:n.transports[o.id]??Qi(o.rpcUrls.default.http.map(p=>Ut(p))),relay:a}),f=[r,me(o)].filter(Boolean).join(":");if(Qt.has(f))return Qt.get(f);const l=kr({...t,chain:o,pollingInterval:1e3,transport:d});return Qt.set(f,l),l}const gn=fi;function vs(e,t){const{chainId:n,expiry:r,permissions:s,id:i,publicKey:a,type:u}=e,{address:c}=t;return{address:c,chainId:n,expiry:r,id:i,key:{publicKey:a,type:u},permissions:s??{}}}function fr(e){const{chainId:t,expiry:n,key:r}=e;return ie({chainId:t,expiry:n,permissions:e.permissions??{},publicKey:r.publicKey,role:"session",type:r.type})}const pr=hi("method",[yi.Request,mi.Request,gi.Request,wi.Request,bi.Request,Ii.Request,Mi.Request,vi.Request,Mn.Request,xi.Request,Ar.Request,jr.Request,Ei.Request,ki.Request,Ai.Request,ji.Request,Pi.Request,zi.Request,Oi.Request,Di.Request,vn.Request,Ci.Request,Ti.Request,kt.Request,At.Request,Si.Request,Ni.Request,_i.Request,$i.Request]);function hr(e,t){const n=pi(e,t);if(n.error){const r=n.error.issues.at(0);throw(r==null?void 0:r.code)==="invalid_union"&&r.note==="No matching discriminator"?new ve:new xe(Er(n.error))}return{...t,_decoded:n.data}}async function yr(e){e.persist.hasHydrated()||await new Promise(t=>{e.persist.onFinishHydration(()=>t(!0)),setTimeout(()=>t(!0),100)})}function Vt(e){if(e)return e.startsWith("/")?`${window.location.origin}${e}`:e}function Kc(e){const{config:t,getMode:n,id:r,store:s}=e,{announceProvider:i}=t;function a(h={}){var m;const g=u(),y=h.request??hr(pr,{method:"wallet_getCapabilities",params:h.chainIds?[void 0,h.chainIds]:void 0});return $t(()=>n().actions.getCapabilities({chainIds:h.chainIds,internal:{client:g,config:t,request:y,store:s}}),{cacheKey:`getCapabilities.${r}.${(m=h.chainIds)==null?void 0:m.join(",")}`})}function u(h){const g=typeof h=="string"?Ge(h):h;return qc({_internal:e},{chainId:g})}const c=new Map,o=[],d=jo(),f=Sr({...d,async request(h){await yr(s);const g=["eth_accounts","eth_chainId","eth_requestAccounts","wallet_getAssets","wallet_getCapabilities","wallet_getKeys","wallet_getPermissions","wallet_getAccountVersion","wallet_connect"].includes(h.method);return be(async()=>{var k,A,z,O,P,T,U,$;let y;try{y=hr(pr,h)}catch(b){const I=b;if(!(I instanceof ve))throw I;if(h.method.startsWith("wallet_"))throw new at;return u().request(h)}const m=s.getState();switch(y.method){case"account_verifyEmail":{if(m.accounts.length===0)throw new W;const[b]=y._decoded.params,{chainId:I,email:w,token:v,walletAddress:E}=b,M=u(I);if(I&&I!==M.chain.id)throw new pe;const x=E?m.accounts.find(j=>K(j.address,E)):m.accounts[0];if(!x)throw new Y;return await n().actions.verifyEmail({account:x,chainId:I,email:w,internal:{client:M,config:t,request:y,store:s},token:v,walletAddress:E})}case"wallet_addFunds":{if(m.accounts.length===0)throw new W;const{address:b,value:I,token:w}=y.params[0]??{},v=b?m.accounts.find(x=>K(x.address,b)):m.accounts[0];if(!v)throw new Y;const E=u(),M=await n().actions.addFunds({address:v.address,internal:{client:E,config:t,request:y,store:s},token:w,value:I});return d.emit("message",{data:null,type:"assetsChanged"}),M}case"eth_accounts":{if(m.accounts.length===0)throw new W;return m.accounts.map(We)}case"eth_chainId":return _(m.chainIds[0]);case"eth_requestAccounts":{if(m.accounts.length>0&&c.get("eth_requestAccounts"))return m.accounts.map(We);const b=u(),{accounts:I}=await n().actions.loadAccounts({internal:{client:b,config:t,request:y,store:s}});return s.setState(w=>({...w,accounts:I})),d.emit("connect",{chainId:_(b.chain.id)}),c.set("eth_requestAccounts",!0),setTimeout(()=>c.delete("eth_requestAccounts"),1e3),I.map(We)}case"eth_sendTransaction":{if(m.accounts.length===0)throw new W;const[{capabilities:b,chainId:I,data:w="0x",from:v,to:E,value:M}]=y._decoded.params,x=u(I);if(I&&I!==x.chain.id)throw new pe;const j=v?m.accounts.find(D=>K(D.address,v)):m.accounts[0];if(!j)throw new Y;const{id:N}=await n().actions.sendCalls({account:j,asTxHash:!0,calls:[{data:w,to:E,value:M}],chainId:x.chain.id,internal:{client:x,config:t,request:y,store:s},merchantUrl:Vt(t.merchantUrl??(b==null?void 0:b.merchantUrl))});return N}case"eth_signTypedData_v4":{if(m.accounts.length===0)throw new W;const[b,I]=y._decoded.params,w=m.accounts.find(M=>K(M.address,b));if(!w)throw new Y;const v=u();return await n().actions.signTypedData({account:w,data:I,internal:{client:v,config:t,request:y,store:s}})}case"wallet_grantAdmin":{if(m.accounts.length===0)throw new W;const[{address:b,capabilities:I,chainId:w,key:v}]=y._decoded.params??[{}],E=b?m.accounts.find(D=>K(D.address,b)):m.accounts[0];if(!E)throw new Y;const M=u(w);if((k=Ye([...E.keys??[]]))==null?void 0:k.some(D=>{var R;return((R=D.publicKey)==null?void 0:R.toLowerCase())===v.publicKey.toLowerCase()}))throw new xe({message:"Key already granted as admin."});const{key:j}=await n().actions.grantAdmin({account:E,feeToken:I==null?void 0:I.feeToken,internal:{client:M,config:t,request:y,store:s},key:v});s.setState(D=>{const R=D.accounts.findIndex(q=>E?K(q.address,E.address):!0);return R===-1?D:{...D,accounts:D.accounts.map((q,B)=>B===R?{...q,keys:[...q.keys??[],j]}:q)}});const N=Ye([...E.keys??[],j]);return d.emit("message",{data:null,type:"adminsChanged"}),L(Ar.Response,{address:E.address,chainId:M.chain.id,key:N.at(-1)})}case"wallet_grantPermissions":{if(m.accounts.length===0)throw new W;const[{address:b,chainId:I,...w}]=y._decoded.params??[{}],v=b?m.accounts.find(x=>K(x.address,b)):m.accounts[0];if(!v)throw new Y;const E=u(I),{key:M}=await n().actions.grantPermissions({account:v,internal:{client:E,config:t,request:y,store:s},permissions:w});return s.setState(x=>{const j=x.accounts.findIndex(N=>v?K(N.address,v.address):!0);return j===-1?x:{...x,accounts:x.accounts.map((N,D)=>D===j?{...N,keys:[...N.keys??[],M]}:N)}}),d.emit("message",{data:null,type:"permissionsChanged"}),L(jr.Response,{...vs(M,{address:v.address})})}case"wallet_getAdmins":{if(m.accounts.length===0)throw new W;const[{address:b,chainId:I}]=y._decoded.params??[{}],w=b?m.accounts.find(x=>K(x.address,b)):m.accounts[0];if(!w)throw new Y;const v=u(I),E=await n().actions.getKeys({account:w,internal:{client:v,config:t,request:y,store:s}}),M=Ye(E);return L(Mn.Response,{address:w.address,chainId:v.chain.id,keys:M})}case"wallet_prepareUpgradeAccount":{const[{address:b,capabilities:I,chainId:w}]=y._decoded.params??[{}],{email:v,label:E,grantPermissions:M}=I??{},x=u(w),{context:j,digests:N}=await n().actions.prepareUpgradeAccount({address:b,email:v,internal:{client:x,config:t,request:y,store:s},label:E,permissions:M});return o.push(j.account),{context:j,digests:N}}case"wallet_getAccountVersion":{if(m.accounts.length===0)throw new W;const[{address:b}]=y._decoded.params??[{}],I=b?m.accounts.find(M=>K(M.address,b)):m.accounts[0];if(!I)throw new Y;const w=u(),{current:v,latest:E}=await n().actions.getAccountVersion({address:I.address,internal:{client:w,config:t,request:y,store:s}});return{current:v,latest:E}}case"wallet_getKeys":{if(m.accounts.length===0)throw new W;const[{address:b,chainIds:I}]=y._decoded.params??[{}],w=m.accounts.find(M=>K(M.address,b));if(!w)throw new Y;const v=u(),E=await n().actions.getKeys({account:w,chainIds:I,internal:{client:v,config:t,request:y,store:s}});return L(kt.Response,E)}case"wallet_getPermissions":{if(m.accounts.length===0)throw new W;const[{address:b,chainIds:I}]=y._decoded.params??[{}],w=b?m.accounts.find(x=>K(x.address,b)):m.accounts[0];if(!w)throw new Y;const v=u(),E=await n().actions.getKeys({account:w,chainIds:I,internal:{client:v,config:t,request:y,store:s}});return Ht(E,{address:w.address})}case"wallet_revokeAdmin":{if(m.accounts.length===0)throw new W;const[{address:b,capabilities:I,id:w}]=y._decoded.params,v=b?m.accounts.find(x=>K(x.address,b)):m.accounts[0];if(!v)throw new Y;const E=u();await n().actions.revokeAdmin({account:v,feeToken:I==null?void 0:I.feeToken,id:w,internal:{client:E,config:t,request:y,store:s}});const M=(A=v.keys)==null?void 0:A.filter(x=>x.id.toLowerCase()!==w.toLowerCase());s.setState(x=>({...x,accounts:x.accounts.map(j=>K(j.address,v.address)?{...j,keys:M}:j)})),d.emit("message",{data:null,type:"adminsChanged"});return}case"wallet_revokePermissions":{if(m.accounts.length===0)throw new W;const[{address:b,capabilities:I,id:w}]=y._decoded.params,v=b?m.accounts.find(x=>K(x.address,b)):m.accounts[0];if(!v)throw new Y;const E=u();await n().actions.revokePermissions({account:v,feeToken:I==null?void 0:I.feeToken,id:w,internal:{client:E,config:t,request:y,store:s}});const M=(z=v.keys)==null?void 0:z.filter(x=>x.id.toLowerCase()!==w.toLowerCase());s.setState(x=>({...x,accounts:x.accounts.map(j=>K(j.address,v.address)?{...j,keys:M}:j)})),d.emit("message",{data:null,type:"permissionsChanged"});return}case"wallet_upgradeAccount":{const[{context:b,signatures:I}]=y._decoded.params??[{}],w=u(),v=o.find(j=>K(j.address,b.account.address));if(!v)throw new Y;const{account:E}=await n().actions.upgradeAccount({account:v,context:b,internal:{client:w,config:t,request:y,store:s},signatures:I}),M=Ye(E.keys??[]),x=Ht(E.keys??[],{address:E.address});return s.setState(j=>({...j,accounts:[E]})),d.emit("connect",{chainId:_(w.chain.id)}),{address:E.address,capabilities:{admins:M,...x.length>0?{permissions:x}:{}}}}case"porto_ping":return"pong";case"personal_sign":{if(m.accounts.length===0)throw new W;const[b,I]=y._decoded.params,w=m.accounts.find(M=>K(M.address,I));if(!w)throw new Y;const v=u();return await n().actions.signPersonalMessage({account:w,data:b,internal:{client:v,config:t,request:y,store:s}})}case"wallet_connect":{const[{capabilities:b,chainIds:I}]=y._decoded.params??[{}],w=u(I==null?void 0:I[0]),v=w.chain.id,{createAccount:E,email:M,grantAdmins:x,grantPermissions:j,selectAccount:N,signInWithEthereum:D}=b??{},R={client:w,config:t,request:y,store:s},{accounts:q}=await(async()=>{if(M||E){const{label:X=void 0}=typeof E=="object"?E:{},{account:ue}=await n().actions.createAccount({admins:x,email:M,internal:R,label:X,permissions:j,signInWithEthereum:D});return{accounts:[ue]}}const S=m.accounts[0],{address:F,key:ee}=(()=>{var X,ue;if(N)return typeof N=="object"?N:{address:void 0,key:void 0};for(const ce of(S==null?void 0:S.keys)??[])if(ce.type==="webauthn-p256"&&ce.role==="admin")return{address:S==null?void 0:S.address,key:{credentialId:ce.credentialId??((ue=(X=ce.privateKey)==null?void 0:X.credential)==null?void 0:ue.id),publicKey:ce.publicKey}};return{address:void 0,key:void 0}})(),ge={internal:R,permissions:j,signInWithEthereum:D};try{return await n().actions.loadAccounts({address:F,key:ee,...ge})}catch(X){if(X instanceof Ne)throw X;if(F&&ee)return await n().actions.loadAccounts(ge);throw X}})();s.setState(S=>({...S,accounts:q}));const B=[v,...s.getState().chainIds.filter(S=>S!==v)];return d.emit("connect",{chainId:_(B[0])}),{accounts:q.map(S=>({address:We(S),capabilities:{admins:S.keys?Ye(S.keys):[],permissions:S.keys?Ht(S.keys,{address:S.address}):[],...S.signInWithEthereum&&{signInWithEthereum:S.signInWithEthereum}}})),chainIds:B.map(S=>_(S))}}case"wallet_disconnect":{const b=u();await((P=(O=n().actions).disconnect)==null?void 0:P.call(O,{internal:{client:b,config:t,request:y,store:s}})),s.setState(I=>({...I,accounts:[]})),d.emit("disconnect",new W);return}case"wallet_getAssets":{const[b]=y._decoded.params??[],{account:I,chainFilter:w,assetFilter:v,assetTypeFilter:E}=b,M=u(),x=await n().actions.getAssets({account:I,assetFilter:v,assetTypeFilter:E,chainFilter:w,internal:{client:M,config:t,request:y,store:s}}),j=Object.entries(x).reduce((N,[D,R])=>(N[_(Number(D))]=R,N),{});return L(vn.Response,j)}case"wallet_getCallsStatus":{const[b]=y._decoded.params??[],I=u();return await n().actions.getCallsStatus({id:b,internal:{client:I,config:t,request:y,store:s}})}case"wallet_getCapabilities":{const[b,I]=y.params??[];return await a({chainIds:I,request:y})}case"wallet_prepareCalls":{const[b]=y._decoded.params,{calls:I,capabilities:w,chainId:v,key:E,from:M}=b,x=u(v),j=M??m.accounts[0];if(!j)throw new Y;if(v&&v!==x.chain.id)throw new pe;const{digest:N,...D}=await n().actions.prepareCalls({account:ne(j),calls:I,feeToken:w==null?void 0:w.feeToken,internal:{client:x,config:t,request:y,store:s},key:E,merchantUrl:Vt(t.merchantUrl??(w==null?void 0:w.merchantUrl)),requiredFunds:w==null?void 0:w.requiredFunds});return L(At.Response,{capabilities:D.capabilities,chainId:_(D.chainId??x.chain.id),context:{...D.context,account:{address:D.account.address},calls:D.context.calls??[],nonce:D.context.nonce??0n},digest:N,key:D.key,typedData:D.typedData})}case"wallet_sendPreparedCalls":{const[b]=y._decoded.params,{chainId:I,context:w,key:v,signature:E}=b,{account:M}=b.context,x=u(I);if(I&&Ge(I)!==x.chain.id)throw new pe;return[{id:await n().actions.sendPreparedCalls({account:ne(M),context:w,internal:{client:x,config:t,request:y,store:s},key:v,signature:E})}]}case"wallet_sendCalls":{if(m.accounts.length===0)throw new W;const[b]=y._decoded.params,{calls:I,capabilities:w,chainId:v,from:E}=b,M=u(v);if(v&&v!==M.chain.id)throw new pe;const x=E?m.accounts.find(N=>K(N.address,E)):m.accounts[0];if(!x)throw new Y;const{id:j}=await n().actions.sendCalls({account:x,calls:I,chainId:M.chain.id,feeToken:w==null?void 0:w.feeToken,internal:{client:M,config:t,request:y,store:s},merchantUrl:Vt(t.merchantUrl??(w==null?void 0:w.merchantUrl)),permissionsId:(T=w==null?void 0:w.permissions)==null?void 0:T.id,requiredFunds:w==null?void 0:w.requiredFunds});return{id:j}}case"wallet_switchEthereumChain":{const[b]=y._decoded.params,{chainId:I}=b,w=Ge(I);if(!t.chains.find(M=>M.id===w))throw new Pt;const E=u(I);await(($=(U=n().actions).switchChain)==null?void 0:$.call(U,{chainId:E.chain.id,internal:{client:E,config:t,request:y,store:s}})),s.setState(M=>({...M,chainIds:[w,...M.chainIds.filter(x=>x!==w)]}));return}case"wallet_verifySignature":{const[b]=y._decoded.params,{address:I,chainId:w,digest:v,signature:E}=b,M=u(w);return{...await $c(M,{address:I,digest:v,signature:E}),address:I,chainId:_(M.chain.id)}}}},{enabled:g,id:me(h)})}});function l(){let h=()=>{},g=()=>{};yr(s).then(()=>{a().catch(()=>{}),h(),h=s.subscribe(m=>m.accounts,m=>{d.emit("accountsChanged",m.map(We))},{equalityFn:(m,k)=>m.every((A,z)=>{var O;return A.address===((O=k[z])==null?void 0:O.address)})}),g(),g=s.subscribe(m=>m.chainIds[0],(m,k)=>{m!==k&&d.emit("chainChanged",_(m))})});const y=Bc(f,i);return()=>{h(),g(),y()}}const p=l();return Object.assign(f,{_internal:{destroy:p}})}function Bc(e,t){if(!t)return()=>{};if(typeof window>"u"||!window.dispatchEvent)return()=>{};const{icon:n="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDIyIiBoZWlnaHQ9IjQyMiIgdmlld0JveD0iMCAwIDQyMiA0MjIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MjIiIGhlaWdodD0iNDIyIiBmaWxsPSJibGFjayIvPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMV8xNSkiPgo8cGF0aCBkPSJNODEgMjg2LjM2NkM4MSAyODAuODkzIDg1LjQ1MDUgMjc2LjQ1NSA5MC45NDA0IDI3Ni40NTVIMzI5LjUxMUMzMzUuMDAxIDI3Ni40NTUgMzM5LjQ1MiAyODAuODkzIDMzOS40NTIgMjg2LjM2NlYzMDYuMTg4QzMzOS40NTIgMzExLjY2MiAzMzUuMDAxIDMxNi4wOTkgMzI5LjUxMSAzMTYuMDk5SDkwLjk0MDRDODUuNDUwNSAzMTYuMDk5IDgxIDMxMS42NjIgODEgMzA2LjE4OFYyODYuMzY2WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTAuOTQwNCAyMzQuODI4Qzg1LjQ1MDUgMjM0LjgyOCA4MSAyMzkuMjY2IDgxIDI0NC43MzlWMjcxLjUzMUM4My44NDMyIDI2OS42MzMgODcuMjYyMiAyNjguNTI2IDkwLjk0MDQgMjY4LjUyNkgzMjkuNTExQzMzMy4xODggMjY4LjUyNiAzMzYuNjA4IDI2OS42MzMgMzM5LjQ1MiAyNzEuNTMxVjI0NC43MzlDMzM5LjQ1MiAyMzkuMjY2IDMzNS4wMDEgMjM0LjgyOCAzMjkuNTExIDIzNC44MjhIOTAuOTQwNFpNMzM5LjQ1MiAyODYuMzY2QzMzOS40NTIgMjgwLjg5MyAzMzUuMDAxIDI3Ni40NTUgMzI5LjUxMSAyNzYuNDU1SDkwLjk0MDRDODUuNDUwNSAyNzYuNDU1IDgxIDI4MC44OTMgODEgMjg2LjM2NlYzMDYuMTlDODEgMzExLjY2NCA4NS40NTA1IDMxNi4xMDEgOTAuOTQwNCAzMTYuMTAxSDMyOS41MTFDMzM1LjAwMSAzMTYuMTAxIDMzOS40NTIgMzExLjY2NCAzMzkuNDUyIDMwNi4xOVYyODYuMzY2WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTAuOTQwNCAxOTMuMjAxQzg1LjQ1MDUgMTkzLjIwMSA4MSAxOTcuNjM4IDgxIDIwMy4xMTJWMjI5LjkwM0M4My44NDMyIDIyOC4wMDYgODcuMjYyMiAyMjYuODk5IDkwLjk0MDQgMjI2Ljg5OUgzMjkuNTExQzMzMy4xODggMjI2Ljg5OSAzMzYuNjA4IDIyOC4wMDYgMzM5LjQ1MiAyMjkuOTAzVjIwMy4xMTJDMzM5LjQ1MiAxOTcuNjM4IDMzNS4wMDEgMTkzLjIwMSAzMjkuNTExIDE5My4yMDFIOTAuOTQwNFpNMzM5LjQ1MiAyNDQuNzM5QzMzOS40NTIgMjM5LjI2NSAzMzUuMDAxIDIzNC44MjggMzI5LjUxMSAyMzQuODI4SDkwLjk0MDRDODUuNDUwNSAyMzQuODI4IDgxIDIzOS4yNjUgODEgMjQ0LjczOVYyNzEuNTNDODEuMjE3NSAyNzEuMzg1IDgxLjQzODMgMjcxLjI0NSA4MS42NjI0IDI3MS4xMDlDODMuODMyNSAyNjkuNzk0IDg2LjMwNTQgMjY4LjkyNyA4OC45NTIzIDI2OC42MzVDODkuNjA1MSAyNjguNTYzIDkwLjI2ODQgMjY4LjUyNiA5MC45NDA0IDI2OC41MjZIMzI5LjUxMUMzMzAuMTgzIDI2OC41MjYgMzMwLjg0NiAyNjguNTYzIDMzMS40OTggMjY4LjYzNUMzMzQuNDE5IDI2OC45NTcgMzM3LjEyOCAyNjkuOTggMzM5LjQ1MiAyNzEuNTNWMjQ0LjczOVpNMzM5LjQ1MiAyODYuMzY2QzMzOS40NTIgMjgxLjAyMSAzMzUuMjA2IDI3Ni42NjMgMzI5Ljg5MyAyNzYuNDYyQzMyOS43NjcgMjc2LjQ1NyAzMjkuNjQgMjc2LjQ1NSAzMjkuNTExIDI3Ni40NTVIOTAuOTQwNEM4NS40NTA1IDI3Ni40NTUgODEgMjgwLjg5MyA4MSAyODYuMzY2VjMwNi4xODhDODEgMzExLjY2MiA4NS40NTA1IDMxNi4xMDEgOTAuOTQwNCAzMTYuMTAxSDMyOS41MTFDMzM1LjAwMSAzMTYuMTAxIDMzOS40NTIgMzExLjY2MiAzMzkuNDUyIDMwNi4xODhWMjg2LjM2NloiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8cGF0aCBvcGFjaXR5PSIwLjMiIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTguMDE0NiAxMDRDODguNjE3NyAxMDQgODEgMTExLjU5NSA4MSAxMjAuOTY1VjE4OC4yNzZDODMuODQzMiAxODYuMzc5IDg3LjI2MjIgMTg1LjI3MiA5MC45NDA0IDE4NS4yNzJIMzI5LjUxMUMzMzMuMTg4IDE4NS4yNzIgMzM2LjYwOCAxODYuMzc5IDMzOS40NTIgMTg4LjI3NlYxMjAuOTY1QzMzOS40NTIgMTExLjU5NSAzMzEuODMzIDEwNCAzMjIuNDM3IDEwNEg5OC4wMTQ2Wk0zMzkuNDUyIDIwMy4xMTJDMzM5LjQ1MiAxOTcuNjM4IDMzNS4wMDEgMTkzLjIwMSAzMjkuNTExIDE5My4yMDFIOTAuOTQwNEM4NS40NTA1IDE5My4yMDEgODEgMTk3LjYzOCA4MSAyMDMuMTEyVjIyOS45MDNDODEuMjE3NSAyMjkuNzU4IDgxLjQzODMgMjI5LjYxOCA4MS42NjI0IDIyOS40ODJDODMuODMyNSAyMjguMTY3IDg2LjMwNTQgMjI3LjMgODguOTUyMyAyMjcuMDA4Qzg5LjYwNTEgMjI2LjkzNiA5MC4yNjg0IDIyNi44OTkgOTAuOTQwNCAyMjYuODk5SDMyOS41MTFDMzMwLjE4MyAyMjYuODk5IDMzMC44NDYgMjI2LjkzNiAzMzEuNDk4IDIyNy4wMDhDMzM0LjQxOSAyMjcuMzMgMzM3LjEyOCAyMjguMzUyIDMzOS40NTIgMjI5LjkwM1YyMDMuMTEyWk0zMzkuNDUyIDI0NC43MzlDMzM5LjQ1MiAyMzkuMzkzIDMzNS4yMDYgMjM1LjAzNiAzMjkuODkzIDIzNC44MzVDMzI5Ljc2NyAyMzQuODMgMzI5LjY0IDIzNC44MjggMzI5LjUxMSAyMzQuODI4SDkwLjk0MDRDODUuNDUwNSAyMzQuODI4IDgxIDIzOS4yNjUgODEgMjQ0LjczOVYyNzEuNTNMODEuMDcwNyAyNzEuNDgzQzgxLjI2NTMgMjcxLjM1NSA4MS40NjI1IDI3MS4yMyA4MS42NjI0IDI3MS4xMDlDODEuOTA4MyAyNzAuOTYgODIuMTU4MSAyNzAuODE3IDgyLjQxMTcgMjcwLjY3OUM4NC4zOTUzIDI2OS42MDUgODYuNjA1NCAyNjguODk0IDg4Ljk1MjMgMjY4LjYzNUM4OS4wMDUyIDI2OC42MjkgODkuMDU4IDI2OC42MjQgODkuMTExIDI2OC42MThDODkuNzEyNSAyNjguNTU3IDkwLjMyMjggMjY4LjUyNiA5MC45NDA0IDI2OC41MjZIMzI5LjUxMUMzMjkuNzM4IDI2OC41MjYgMzI5Ljk2NSAyNjguNTMgMzMwLjE5MiAyNjguNTM5QzMzMC42MzEgMjY4LjU1NSAzMzEuMDY3IDI2OC41ODcgMzMxLjQ5OCAyNjguNjM1QzMzNC40MTkgMjY4Ljk1NyAzMzcuMTI4IDI2OS45OCAzMzkuNDUyIDI3MS41M1YyNDQuNzM5Wk0zMzkuNDUyIDI4Ni4zNjZDMzM5LjQ1MiAyODEuMDIxIDMzNS4yMDYgMjc2LjY2MyAzMjkuODkzIDI3Ni40NjJMMzI5Ljg2NSAyNzYuNDYxQzMyOS43NDggMjc2LjQ1NyAzMjkuNjI5IDI3Ni40NTUgMzI5LjUxMSAyNzYuNDU1SDkwLjk0MDRDODUuNDUwNSAyNzYuNDU1IDgxIDI4MC44OTMgODEgMjg2LjM2NlYzMDYuMTg4QzgxIDMxMS42NjIgODUuNDUwNSAzMTYuMTAxIDkwLjk0MDQgMzE2LjEwMUgzMjkuNTExQzMzNS4wMDEgMzE2LjEwMSAzMzkuNDUyIDMxMS42NjIgMzM5LjQ1MiAzMDYuMTg4VjI4Ni4zNjZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMjY5Ljg2OCAxMzEuNzUyQzI2OS44NjggMTI2LjI3OCAyNzQuMzE4IDEyMS44NCAyNzkuODA4IDEyMS44NEgzMTEuNjE4QzMxNy4xMDggMTIxLjg0IDMyMS41NTggMTI2LjI3OCAzMjEuNTU4IDEzMS43NTJWMTYxLjQ4NUMzMjEuNTU4IDE2Ni45NTkgMzE3LjEwOCAxNzEuMzk2IDMxMS42MTggMTcxLjM5NkgyNzkuODA4QzI3NC4zMTggMTcxLjM5NiAyNjkuODY4IDE2Ni45NTkgMjY5Ljg2OCAxNjEuNDg1VjEzMS43NTJaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzFfMTUiPgo8cmVjdCB3aWR0aD0iMjU5IiBoZWlnaHQ9IjIxMyIgZmlsbD0id2hpdGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgxIDEwNCkiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K",name:r="Porto",rdns:s="xyz.ithaca.porto"}=typeof t=="object"?t:{};return Ri({info:{icon:n,name:r,rdns:s,uuid:En()},provider:e})}function Ye(e){return e.map(t=>{var n,r,s,i,a;if(t.role==="admin")try{return L(Mn.Key,{id:t.id??t.publicKey,publicKey:t.publicKey,type:t.type,...t.type==="webauthn-p256"?{credentialId:(r=(n=t.privateKey)==null?void 0:n.credential)==null?void 0:r.id,privateKey:{credential:{id:(i=(s=t.privateKey)==null?void 0:s.credential)==null?void 0:i.id},rpId:(a=t.privateKey)==null?void 0:a.rpId}}:{}})}catch{return}}).filter(Boolean)}function Ht(e,{address:t}){return e.map(n=>{if(n.chainId&&n.role==="session"&&!(n.expiry>0&&n.expiry<BigInt(Math.floor(Date.now()/1e3))))try{return L(gn,vs(n,{address:t}))}catch{return}}).filter(Boolean)}function We(e){return Ui(e.address)}function xs(e){return{...e,setup:e.setup??(()=>()=>{})}}async function wn(e){var a,u,c;const{account:t,calls:n,permissionsId:r}=e;if(typeof r<"u"){if(r===null)return;const o=(a=t.keys)==null?void 0:a.find(d=>d.publicKey===r&&d.privateKey);if(!o)throw new Error(`permission (id: ${r}) does not exist.`);return o}const s=(u=t.keys)==null?void 0:u.find(o=>!o.privateKey||o.role!=="session"||o.expiry<BigInt(Math.floor(Date.now()/1e3))?!1:!!n.every(f=>{var l,p;return(p=(l=o.permissions)==null?void 0:l.calls)==null?void 0:p.some(h=>{if(h.to&&h.to!==f.to)return!1;if(h.signature){if(!f.data)return!1;const g=Q(f.data,0,4);if(lt(h.signature))return h.signature===g;if(Sn(h.signature)!==g)return!1}return!0})})),i=(c=t.keys)==null?void 0:c.find(o=>o.role==="admin"&&o.privateKey);return s??i}function Fc(e={}){let t=e.id??0;return{prepare(n){return Yc({id:t++,...n})},get id(){return t}}}function Yc(e){return{...e,jsonrpc:"2.0"}}const mt=Li;function gt(e){const{expiry:t,feeToken:n,permissions:r,publicKey:s,type:i}=e;return{expiry:t,feeToken:n??null,key:{publicKey:s,type:i},permissions:r??{}}}async function ye(e,t={}){var c,o;if(!e)return;const n=t.chainId??e.chainId,r=e.expiry??0,s=e.feeToken,i=Is(e,{feeTokens:t.feeTokens}),a={chainId:n,expiry:r,feeToken:s,permissions:i,role:"session"};if(e!=null&&e.key)return ie({...a,publicKey:e.key.publicKey,type:e.key.type??"secp256k1"});if(typeof((o=(c=globalThis.crypto)==null?void 0:c.subtle)==null?void 0:o.generateKey)=="function")try{return await hc(a)}catch(d){if(!Wc(d))throw d}return pc(a)}function Wc(e){var n;if(!(e instanceof Error))return!1;const t=((n=e.message)==null?void 0:n.toLowerCase())??"";return e.name==="TypeError"||e.name==="ReferenceError"||t.includes("subtle")||t.includes("generatekey")}const Qc=/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(:[0-9]{1,5})?$/,Vc=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:[0-9]{1,5})?$/,Hc=/^localhost(:[0-9]{1,5})?$/,Zc=/^[a-zA-Z0-9]{8,}$/,Gc=/^([a-zA-Z][a-zA-Z0-9+-.]*)$/,Jc=/^(?:(?<scheme>[a-zA-Z][a-zA-Z0-9+-.]*):\/\/)?(?<domain>[a-zA-Z0-9+-.]*(?::[0-9]{1,5})?) (?:wants you to sign in with your Ethereum account:\n)(?<address>0x[a-fA-F0-9]{40})\n\n(?:(?<statement>.*)\n\n)?/,Xc=/(?:URI: (?<uri>.+))\n(?:Version: (?<version>.+))\n(?:Chain ID: (?<chainId>\d+))\n(?:Nonce: (?<nonce>[a-zA-Z0-9]+))\n(?:Issued At: (?<issuedAt>.+))(?:\nExpiration Time: (?<expirationTime>.+))?(?:\nNot Before: (?<notBefore>.+))?(?:\nRequest ID: (?<requestId>.+))?/;function eu(e){const{chainId:t,domain:n,expirationTime:r,issuedAt:s=new Date,nonce:i,notBefore:a,requestId:u,resources:c,scheme:o,uri:d,version:f}=e;{if(t!==Math.floor(t))throw new le({field:"chainId",metaMessages:["- Chain ID must be a EIP-155 chain ID.","- See https://eips.ethereum.org/EIPS/eip-155","",`Provided value: ${t}`]});if(!(Qc.test(n)||Vc.test(n)||Hc.test(n)))throw new le({field:"domain",metaMessages:["- Domain must be an RFC 3986 authority.","- See https://www.rfc-editor.org/rfc/rfc3986","",`Provided value: ${n}`]});if(!Zc.test(i))throw new le({field:"nonce",metaMessages:["- Nonce must be at least 8 characters.","- Nonce must be alphanumeric.","",`Provided value: ${i}`]});if(!mr(d))throw new le({field:"uri",metaMessages:["- URI must be a RFC 3986 URI referring to the resource that is the subject of the signing.","- See https://www.rfc-editor.org/rfc/rfc3986","",`Provided value: ${d}`]});if(f!=="1")throw new le({field:"version",metaMessages:["- Version must be '1'.","",`Provided value: ${f}`]});if(o&&!Gc.test(o))throw new le({field:"scheme",metaMessages:["- Scheme must be an RFC 3986 URI scheme.","- See https://www.rfc-editor.org/rfc/rfc3986#section-3.1","",`Provided value: ${o}`]});const m=e.statement;if(m!=null&&m.includes(`
`))throw new le({field:"statement",metaMessages:["- Statement must not include '\\n'.","",`Provided value: ${m}`]})}const l=Vr(e.address,{checksum:!0}),p=o?`${o}://${n}`:n,h=e.statement?`${e.statement}
`:"",g=`${p} wants you to sign in with your Ethereum account:
${l}

${h}`;let y=`URI: ${d}
Version: ${f}
Chain ID: ${t}
Nonce: ${i}
Issued At: ${s.toISOString()}`;if(r&&(y+=`
Expiration Time: ${r.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),u&&(y+=`
Request ID: ${u}`),c){let m=`
Resources:`;for(const k of c){if(!mr(k))throw new le({field:"resources",metaMessages:["- Every resource must be a RFC 3986 URI.","- See https://www.rfc-editor.org/rfc/rfc3986","",`Provided value: ${k}`]});m+=`
- ${k}`}y+=m}return`${g}
${y}`}function mr(e){if(/[^a-z0-9:/?#[\]@!$&'()*+,;=.\-_~%]/i.test(e)||/%[^0-9a-f]/i.test(e)||/%[0-9a-f](:?[^0-9a-f]|$)/i.test(e))return!1;const t=tu(e),n=t[1],r=t[2],s=t[3],i=t[4],a=t[5];if(!(n!=null&&n.length&&s&&s.length>=0))return!1;if(r!=null&&r.length){if(!(s.length===0||/^\//.test(s)))return!1}else if(/^\/\//.test(s))return!1;if(!/^[a-z][a-z0-9+\-.]*$/.test(n.toLowerCase()))return!1;let u="";return u+=`${n}:`,r!=null&&r.length&&(u+=`//${r}`),u+=s,i!=null&&i.length&&(u+=`?${i}`),a!=null&&a.length&&(u+=`#${a}`),u}function tu(e){return e.match(/(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/)}function nu(e){var f,l,p;const{scheme:t,statement:n,...r}=((f=e.match(Jc))==null?void 0:f.groups)??{},{chainId:s,expirationTime:i,issuedAt:a,notBefore:u,requestId:c,...o}=((l=e.match(Xc))==null?void 0:l.groups)??{},d=(p=e.split("Resources:")[1])==null?void 0:p.split(`
- `).slice(1);return{...r,...o,...s?{chainId:Number(s)}:{},...i?{expirationTime:new Date(i)}:{},...a?{issuedAt:new Date(a)}:{},...u?{notBefore:new Date(u)}:{},...c?{requestId:c}:{},...d?{resources:d}:{},...t?{scheme:t}:{},...n?{statement:n}:{}}}class le extends C{constructor(t){const{field:n,metaMessages:r}=t;super(`Invalid Sign-In with Ethereum message field "${n}".`,{metaMessages:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Siwe.InvalidMessageFieldError"})}}async function gr(e){const{address:t,authUrl:n,message:r,signature:s,publicKey:i}=e,{chainId:a}=nu(r);return await fetch(n.verify,{body:JSON.stringify({address:t,chainId:a,message:r,signature:s,walletAddress:t,...i&&{publicKey:i}}),credentials:"include",headers:{"Content-Type":"application/json"},method:"POST"}).then(u=>u.json())}async function Zt(e,t,n){var l;const{chainId:r=(l=e.chain)==null?void 0:l.id,domain:s,uri:i,resources:a,version:u="1"}=t,{address:c}=n,o=t.authUrl?Es(t.authUrl):void 0;if(!r)throw new Error("`chainId` is required.");if(!s)throw new Error("`domain` is required.");if(!t.nonce&&!(o!=null&&o.nonce))throw new Error("`nonce` or `authUrl.nonce` is required.");if(!i)throw new Error("`uri` is required.");const d=await(async()=>{if(t.nonce)return t.nonce;if(!(o!=null&&o.nonce))throw new Error("`nonce` or `authUrl.nonce` is required.");const h=await(await fetch(o.nonce,{body:JSON.stringify({address:c,chainId:r,walletAddress:c}),headers:{"Content-Type":"application/json"},method:"POST"})).json().catch(()=>{});if(!(h!=null&&h.nonce))throw new Error("`nonce` or `authUrl.nonce` is required.");return h.nonce})();return eu({...t,address:n.address,chainId:r,domain:s,nonce:d,resources:a,uri:i,version:u})}function Es(e,t=""){if(!e)return;const n=(()=>{if(typeof e=="string"){const r=e.replace(/\/$/,"");return{logout:r+"/logout",nonce:r+"/nonce",verify:r+"/verify"}}return e})();return{logout:Gt(n.logout,t),nonce:Gt(n.nonce,t),verify:Gt(n.verify,t)}}function Gt(e,t){return!t||!e.startsWith("/")?e:t+e}function ru(e){const t=Pe(e);return Z("0x19",se(`Ethereum Signed Message:
`+J(t)),t)}function wt(e){return H(ru(e))}function su(e,t){const{as:n}=t,r=ks(e),s=Aa(new Uint8Array(r.length));return r.encode(s),n==="Hex"?te(s.bytes):s.bytes}function iu(e,t={}){const{as:n="Hex"}=t;return su(e,{as:n})}function ks(e){return Array.isArray(e)?ou(e.map(t=>ks(t))):au(e)}function ou(e){const t=e.reduce((s,i)=>s+i.length,0),n=As(t);return{length:t<=55?1+t:1+n+t,encode(s){t<=55?s.pushByte(192+t):(s.pushByte(247+n),n===1?s.pushUint8(t):n===2?s.pushUint16(t):n===3?s.pushUint24(t):s.pushUint32(t));for(const{encode:i}of e)i(s)}}}function au(e){const t=typeof e=="string"?ke(e):e,n=As(t.length);return{length:t.length===1&&t[0]<128?1:t.length<=55?1+t.length:1+n+t.length,encode(s){t.length===1&&t[0]<128?s.pushBytes(t):t.length<=55?(s.pushByte(128+t.length),s.pushBytes(t)):(s.pushByte(183+n),n===1?s.pushUint8(t.length):n===2?s.pushUint16(t.length):n===3?s.pushUint24(t.length):s.pushUint32(t.length),s.pushBytes(t))}}}function As(e){if(e<=255)return 1;if(e<=65535)return 2;if(e<=16777215)return 3;if(e<=4294967295)return 4;throw new C("Length is too large.")}function cu(e){return uu(e,{presign:!0})}function uu(e,t={}){const{presign:n}=t;return H(Z("0x05",iu(du(n?{address:e.address,chainId:e.chainId,nonce:e.nonce}:e))))}function du(e){const{address:t,chainId:n,nonce:r}=e,s=aa(e);return[n?_(n):"0x",t,r?_(r):"0x",...s?da(s):[]]}async function wr(e,t){const{account:n=e.account}=t,r=n?ne(n):void 0;if(!r)throw new Error("account is required.");const{domain:{name:s,version:i}}=await qi(e,{address:r.address});if(!e.chain)throw new Error("client.chain is required");return{chainId:e.chain.id,name:s,verifyingContract:r.address,version:i}}async function br(e,t){const{account:n=e.account,chainIds:r}=t,s=n?ne(n):void 0;if(!s)throw new Error("account is required.");const i=await zc(e,{address:s.address,chainIds:r});return Object.entries(i).flatMap(([a,u])=>u.map(c=>mc(c,{chainId:Number(a)})))}async function Je(e,t){var w;const{account:n=e.account,calls:r,chain:s=e.chain,feePayer:i,merchantUrl:a,nonce:u,preCalls:c,requiredFunds:o,revokeKeys:d}=t,f=n?ne(n):void 0,l=t.key??(f?Kt(f,{role:"admin"}):void 0),p=(w=t.authorizeKeys)==null?void 0:w.some(v=>v.role==="session"),{contracts:h,fees:{tokens:g}}=await ut(e,{chainId:s==null?void 0:s.id}),y=p?h.orchestrator.address:void 0,m=(t.authorizeKeys??[]).map(v=>St(v,{feeTokens:g,orchestrator:y})),k=(()=>{var v,E,M;return t.feeToken?t.feeToken:(M=(E=(v=l==null?void 0:l.permissions)==null?void 0:v.spend)==null?void 0:E[0])==null?void 0:M.token})(),A=typeof c=="boolean"?c:!1,z=typeof c=="object"?c.map(({context:v,signature:E})=>({...v.preCall,signature:E})):void 0,O={address:f==null?void 0:f.address,calls:r??[],capabilities:{authorizeKeys:m,meta:{feePayer:i,feeToken:k,nonce:u},preCall:A,preCalls:z,requiredFunds:o,revokeKeys:d==null?void 0:d.map(v=>({hash:v.hash}))},chain:s,key:l?St(l,{feeTokens:g}):void 0},P=await(async()=>{if(a){const v=kr({chain:e.chain,transport:Ut(a)});return await Wt(v,O).catch(E=>(console.error(E),Wt(e,O)))}return await Wt(e,O)})(),{capabilities:T,context:U,digest:$,signature:b,typedData:I}=P;if(a&&!await _c(e,{response:P._raw,signature:b}))throw new Error(`cannot verify integrity of \`wallet_prepareCalls\` response from ${a}`);return{capabilities:{...T,quote:U.quote},context:U,digest:$,key:l,typedData:I}}async function js(e,t){const{address:n,authorizeKeys:r,chain:s=e.chain}=t;if(!s)throw new Error("chain is required.");const{contracts:i,fees:{tokens:a}}=await ut(e,{chainId:s.id}),u=t.delegation??i.accountProxy.address,o=r.some(m=>m.role==="session")?i.orchestrator.address:void 0,d=r.map(m=>{const k=m.role==="session"?m.permissions:{};return St({...m,permissions:k},{feeTokens:a,orchestrator:o})}),{capabilities:f,chainId:l,context:p,digests:h,typedData:g}=await Dc(e,{address:n,authorizeKeys:d,chain:s,delegation:u}),y=ne({address:n,keys:r});return{capabilities:f,chainId:l,context:{...p,account:y},digests:h,typedData:g}}async function bt(e,t){const{account:n=e.account,chain:r=e.chain,webAuthn:s}=t;if(!r)throw new Error("`chain` is required.");const i=n?ne(n):void 0;if(!i)throw new Error("`account` is required.");const a=t.key??Kt(i,t);if(!a&&!i.sign)throw new Error("`key` or `account` with `sign` is required");const u=await Promise.all((t.preCalls??[]).map(async l=>{if(l.signature)return l;const{authorizeKeys:p,key:h,calls:g,revokeKeys:y}=l,{context:m,digest:k}=await Je(e,{account:i,authorizeKeys:p,calls:g,chain:r,feeToken:t.feeToken,key:h,preCalls:!0,revokeKeys:y}),A=await Ie(h,{address:null,payload:k,webAuthn:s});return{context:m,signature:A}})),{capabilities:c,context:o,digest:d}=await Je(e,{...t,account:i,chain:r,key:a,preCalls:u}),f=await(async()=>a?await Ie(a,{address:null,payload:d,webAuthn:s,wrap:!1}):await i.sign({hash:d}))();return await xt(e,{capabilities:c.feeSignature?{feeSignature:c.feeSignature}:void 0,context:o,key:a,signature:f})}async function xt(e,t){const{capabilities:n,context:r,key:s,signature:i}=t;return await Cc(e,{capabilities:n,context:r,key:s?St(s):void 0,signature:i})}async function Ir(e,t){const{email:n,walletAddress:r}=t;return await Tc(e,{email:n,walletAddress:r})}async function bn(e,t){if(t.account){const{account:i}=t,a=[...i.keys??[],...t.authorizeKeys??[]].filter((d,f,l)=>l.findIndex(p=>p.id===d.id)===f),{digests:u,...c}=await js(e,{...t,address:i.address,authorizeKeys:a}),o={auth:await i.sign({hash:u.auth}),exec:await i.sign({hash:u.exec})};return await bn(e,{...c,signatures:o})}const{context:n,signatures:r}=t,s=ne(n.account);return await Sc(e,{context:n,signatures:r}),s}async function lu(e,t){const{chainId:n,email:r,signature:s,token:i,walletAddress:a}=t;return await Nc(e,{chainId:n,email:r,signature:s,token:i,walletAddress:a})}const Ps="0x8010801080108010801080108010801080108010801080108010801080108010",fu=ts("(uint256 chainId, address delegation, uint256 nonce, uint8 yParity, uint256 r, uint256 s), address to, bytes data");function pu(e){if(typeof e=="string"){if(Q(e,-32)!==Ps)throw new yu(e)}else Pn(e.authorization)}function hu(e){const{data:t,signature:n}=e;pu(e);const r=Gr({payload:cu(e.authorization),signature:es(e.authorization)}),s=Le(fu,[{...e.authorization,delegation:e.authorization.address,chainId:BigInt(e.authorization.chainId)},e.to??r,t??"0x"]),i=_(J(s),{size:32});return Z(n,s,i,Ps)}class yu extends C{constructor(t){super(`Value \`${t}\` is an invalid ERC-8010 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SignatureErc8010.InvalidWrappedSignatureError"})}}async function Qe(e,t){const{address:n}=t,{authorization:r,data:s,to:i}=await Ac(e,{address:n});return hu({authorization:{...r,nonce:BigInt(r.nonce),r:BigInt(r.r),s:BigInt(r.s)},data:s,signature:t.signature,to:i})}function Mr(e,t){const{tokens:n}=t,r=n.filter(s=>s.interop);return e.map(s=>{if(s.address)return s;const i=r.find(a=>a.symbol===s.symbol);if(!i)throw new Error(`interop token not found: ${s.symbol}`);return{address:i.address,value:hs(s.value,i.decimals)}})}async function fe(e,t){const{chain:n=e.chain}=t??{};return await ut(e,{chainId:n==null?void 0:n.id}).then(s=>s.fees.tokens)}async function In(e,t){const{addressOrSymbol:n}=t;return(await fe(e,t)).find(In.predicate(n))}(function(e){function t(n){return r=>n?je(n)?K(r.address,n):n==="native"?r.address===Xe:n===r.symbol:!1}e.predicate=t})(In||(In={}));async function De(e,t){const{chain:n=e.chain,store:r}=t??{},s=(r==null?void 0:r.getState())??{},i=(t==null?void 0:t.addressOrSymbol)??s.feeToken,a=await fe(e,{chain:n}).then(c=>c.filter(o=>o.feeToken));return a==null?void 0:a.find(c=>i?i==="native"&&c.address===Xe||je(i)&&K(c.address,i)?!0:i===c.symbol:!1)}function zs(e={}){const t=e,{mock:n,multichain:r=!0,webAuthn:s}=t;let i,a;const u=(()=>{var c;if(t.keystoreHost!=="self"&&!(typeof window<"u"&&((c=window.location)==null?void 0:c.hostname)==="localhost"))return t.keystoreHost})();return xs({actions:{async addFunds(){throw new at},async createAccount(c){const{admins:o,email:d,label:f,permissions:l,internal:p,signInWithEthereum:h}=c,{client:g}=p,y=Ic(ra()),m=await fe(g),k=n?ur():await cr({createFn:s==null?void 0:s.createFn,label:f||`${y.address.slice(0,8)}${y.address.slice(-6)}`,rpId:u,userId:Ee(y.address)}),A=await ye(l,{chainId:g.chain.id,feeTokens:m}),z=o==null?void 0:o.map(T=>ie(T)),O=await bn(g,{account:y,authorizeKeys:[k,...z??[],...A?[A]:[]]});i=y.address,d&&f&&await Ir(g,{email:f,walletAddress:O.address});const P=await(async()=>{if(!h)return;const T=await Zt(g,h,{address:O.address}),U=await Fe(y,{payload:wt(se(T))}),$=await Qe(g,{address:O.address,signature:U});return{message:T,signature:$}})();return{account:{...O,signInWithEthereum:P}}},async getAccountVersion(c){const{address:o,internal:d}=c,{client:f}=d,{contracts:l}=await ut(f),{accountImplementation:p}=l,h=await wr(f,{account:ne(p)}).then(y=>y.version),g=await wr(f,{account:o}).then(y=>y.version).catch(()=>h);if(!g||!h)throw new Error("version not found.");return{current:g,latest:h}},async getAssets(c){const{account:o,chainFilter:d,assetFilter:f,assetTypeFilter:l,internal:p}=c,{client:h}=p;return await jc(h,{account:o,assetFilter:f,assetTypeFilter:l,chainFilter:d})},async getCallsStatus(c){var p;const{id:o,internal:d}=c,{client:f}=d,l=await Pc(f,{id:o});return{atomic:!0,chainId:_(f.chain.id),id:o,receipts:(p=l.receipts)==null?void 0:p.map(h=>({blockHash:h.blockHash,blockNumber:_(h.blockNumber),gasUsed:_(h.gasUsed),logs:h.logs,status:h.status,transactionHash:h.transactionHash})),status:l.status,version:"1.0"}},async getCapabilities(c){const{chainIds:o,internal:d}=c,{client:f}=d,l={atomic:{status:"supported"},atomicBatch:{supported:!0},feeToken:{supported:!0,tokens:[]},merchant:{supported:!0},permissions:{supported:!0},requiredFunds:{supported:!!r,tokens:[]}},p=await ut(f,{chainIds:o?o.map(h=>Ge(h)):"all",raw:!0});return Object.entries(p).reduce((h,[g,y])=>({...h,[g]:{...l,...y,feeToken:{supported:!0,tokens:y.fees.tokens},requiredFunds:{supported:!!r,tokens:r?y.fees.tokens.filter(m=>m.interop):[]}}}),{})},async getKeys(c){const{account:o,chainIds:d,internal:f}=c,{client:l}=f,p=await br(l,{account:o,chainIds:d});return _r([...p,...o.keys??[]],h=>h.publicKey)},async grantAdmin(c){const{account:o,internal:d}=c,{client:f}=d,l=ie(c.key,{chainId:f.chain.id}),p=await De(f,{addressOrSymbol:c.feeToken,store:d.store}),{id:h}=await bt(f,{account:o,authorizeKeys:[l],feeToken:p==null?void 0:p.address,webAuthn:s});return await Ve(f,{id:h,pollingInterval:500}),{key:l}},async grantPermissions(c){var A;const{account:o,internal:d,permissions:f}=c,{client:l}=d,p=await fe(l),h=await ye(f,{chainId:l.chain.id,feeTokens:p});if(!h)throw new Error("key to authorize not found.");const g=(A=o.keys)==null?void 0:A.find(z=>z.role==="admin"&&z.privateKey);if(!g)throw new Error("admin key not found.");const{context:y,digest:m}=await Je(l,{account:o,authorizeKeys:[h],key:g,preCalls:!0}),k=await Ie(g,{address:null,payload:m});return await xt(l,{context:y,key:g,signature:k}),{key:h}},async loadAccounts(c){const{internal:o,permissions:d,signInWithEthereum:f}=c,{client:l}=o,p=await fe(l),h=await ye(d,{chainId:l.chain.id,feeTokens:p}),{digest:g,digestType:y,message:m}=await(async()=>{if(f&&c.address){const b=await Zt(l,f,{address:c.address});return{context:void 0,digest:wt(se(b)),digestType:"siwe",message:b}}return{context:void 0,digest:"0x",message:void 0}})(),{address:k,credentialId:A,webAuthnSignature:z}=await(async()=>{if(n){if(!i)throw new Error("address_internal not found.");return{address:i,credentialId:void 0}}if(c.address&&c.key)return{address:c.address,credentialId:c.key.credentialId};const b=await ys({challenge:g,getFn:s==null?void 0:s.getFn,rpId:u}),I=b.raw.response,w=kn(new Uint8Array(I.userHandle)),v=b.raw.id;return{address:w,credentialId:v,webAuthnSignature:b}})(),O=await br(l,{account:k,chainIds:[l.chain.id]}),P=ne({address:k,keys:[...O,...h?[h]:[]].map((b,I)=>I===0&&b.type==="webauthn-p256"?gs({...b,credential:{id:A,publicKey:Lt(b.publicKey)},id:k,rpId:u}):b)}),T=Kt(P,{role:"admin"}),U=await(async()=>{if(g!=="0x")return z?Ms(yn(z),{keyType:"webauthn-p256",publicKey:T.publicKey}):await Ie(T,{address:P.address,payload:g})})();if(h){const{context:b,digest:I}=await Je(l,{account:P,authorizeKeys:[h],preCalls:!0}),w=await Ie(T,{address:null,payload:I});await xt(l,{context:b,key:T,signature:w})}const $=await(async()=>{if(f){if(y==="siwe"&&m&&U){const b=await Qe(l,{address:P.address,signature:U});return{message:m,signature:b}}{const b=await Zt(l,f,{address:P.address}),I=await Fe(P,{payload:wt(se(b)),role:"admin"}),w=await Qe(l,{address:P.address,signature:I});return{message:b,signature:w}}}})();return{accounts:[{...P,signInWithEthereum:$}]}},async prepareCalls(c){var U;const{account:o,calls:d,internal:f,merchantUrl:l}=c,{client:p}=f,h=c.key??await wn({account:o,calls:d});if(!h)throw new Error("cannot find authorized key to sign with.");const[g,y]=await Promise.all([fe(p),De(p,{addressOrSymbol:c.feeToken,store:f.store})]),m=Mr(c.requiredFunds??[],{tokens:g}),{capabilities:k,context:A,digest:z,typedData:O}=await Je(p,{account:o,calls:d,feeToken:y==null?void 0:y.address,key:h,merchantUrl:l,requiredFunds:r?m:void 0}),P=((U=A.quote)==null?void 0:U.quotes)??[],T=P[P.length-1];return{account:o,capabilities:{...k,quote:A.quote},chainId:p.chain.id,context:{...A,account:o,calls:d,nonce:T==null?void 0:T.intent.nonce},digest:z,key:h,typedData:O}},async prepareUpgradeAccount(c){const{address:o,email:d,label:f,internal:l,permissions:p}=c,{client:h}=l,[g,y]=await Promise.all([fe(h),De(h,{store:l.store})]),m=n?ur():await cr({createFn:s==null?void 0:s.createFn,label:f||`${o.slice(0,8)}${o.slice(-6)}`,rpId:u,userId:Ee(o)}),k=await ye(p,{chainId:h.chain.id,feeTokens:g}),{context:A,digests:z}=await js(h,{address:o,authorizeKeys:[m,...k?[k]:[]],feeToken:y==null?void 0:y.address});return d&&(a=f),{context:A,digests:z}},async revokeAdmin(c){var h,g,y;const{account:o,id:d,internal:f}=c,{client:l}=f,p=(h=o.keys)==null?void 0:h.find(m=>m.id===d);if(p){if(p.type==="webauthn-p256"&&((g=o.keys)==null?void 0:g.filter(m=>m.type==="webauthn-p256").length)===1)throw new Error("revoke the only WebAuthn key left.");try{const m=await De(l,{addressOrSymbol:c.feeToken,store:f.store}),{id:k}=await bt(l,{account:o,feeToken:m==null?void 0:m.address,revokeKeys:[p],webAuthn:s});await Ve(l,{id:k})}catch(m){const k=m;if(k.name==="Rpc.ExecutionError"&&((y=k.abiError)==null?void 0:y.name)==="KeyDoesNotExist")return;throw m}}},async revokePermissions(c){var h,g;const{account:o,id:d,internal:f}=c,{client:l}=f,p=(h=o.keys)==null?void 0:h.find(y=>y.id===d);if(p){if(p.role==="admin")throw new Error("cannot revoke admins.");try{const y=await De(l,{addressOrSymbol:c.feeToken,store:f.store}),{id:m}=await bt(l,{account:o,feeToken:y==null?void 0:y.address,revokeKeys:[p],webAuthn:s});await Ve(l,{id:m})}catch(y){const m=y;if(m.name==="Rpc.ExecutionError"&&((g=m.abiError)==null?void 0:g.name)==="KeyDoesNotExist")return;throw y}}},async sendCalls(c){const{account:o,asTxHash:d,calls:f,chainId:l,internal:p,merchantUrl:h}=c,{client:g}=p,y=await wn({account:o,calls:f,permissionsId:c.permissionsId}),[m,k]=await Promise.all([fe(g),De(g,{addressOrSymbol:c.feeToken,store:p.store})]),A=Mr(c.requiredFunds??[],{tokens:m}),z=await bt(g,{account:o,calls:f,feeToken:k==null?void 0:k.address,key:y,merchantUrl:h,requiredFunds:r?A:void 0,webAuthn:s,...l?{chain:{id:l}}:{}});if(d){const{id:O,receipts:P,status:T}=await Ve(g,{id:z.id,pollingInterval:500});if(!(P!=null&&P[0]))throw T==="success"?new ct({message:"Call bundle with id: "+O+" not found."}):new Me({message:"Transaction failed under call bundle id: "+O+"."});return{id:P[0].transactionHash}}return z},async sendPreparedCalls(c){const{context:o,key:d,internal:f,signature:l}=c,{client:p}=f,{id:h}=await xt(p,{context:o,key:d,signature:l});return h},async signPersonalMessage(c){var g;const{account:o,data:d,internal:f}=c,{client:l}=f,p=(g=o.keys)==null?void 0:g.find(y=>y.role==="admin"&&y.privateKey);if(!p)throw new Error("cannot find admin key to sign with.");const h=await Fe(o,{key:p,payload:wt(d),webAuthn:s});return Qe(l,{address:o.address,signature:h})},async signTypedData(c){var y,m;const{account:o,internal:d}=c,{client:f}=d,l=(y=o.keys)==null?void 0:y.find(k=>k.role==="admin"&&k.privateKey);if(!l)throw new Error("cannot find admin key to sign with.");const p=Ki(c.data),h=((m=p.domain)==null?void 0:m.name)==="Orchestrator",g=await Fe(o,{key:l,payload:Tn(p),replaySafe:!h,webAuthn:s});return h?g:Qe(f,{address:o.address,signature:g})},async upgradeAccount(c){const{account:o,context:d,internal:f,signatures:l}=c,{client:p}=f;return await bn(p,{context:d,signatures:l}),a&&await Ir(p,{email:a,walletAddress:o.address}),{account:o}},async verifyEmail(c){var k;const{account:o,chainId:d,email:f,token:l,internal:p,walletAddress:h}=c,{client:g}=p,y=(k=o.keys)==null?void 0:k.find(A=>A.role==="admin"&&A.privateKey);if(!y)throw new Error("cannot find admin key to sign with.");const m=await Fe(o,{key:y,payload:H(se(`${f}${l}`)),webAuthn:s});return await lu(g,{chainId:d,email:f,signature:m,token:l,walletAddress:h})}},config:e,name:"rpc"})}function mu(e={}){const{fallback:t=zs(),host:n=Ur.prod,renderer:r=No(),theme:s,themeController:i}=e,a=new Set,u=Fc();function c(o){return Sr({async request(d){const f=u.prepare(d);return o.setState(l=>{var g;const p=l.accounts[0],h=(g=p==null?void 0:p.keys)==null?void 0:g.find(y=>y.role==="admin"&&y.type==="webauthn-p256");return{...l,requestQueue:[...l.requestQueue,{account:p?{address:p.address,key:h?{credentialId:h==null?void 0:h.credentialId,publicKey:h.publicKey}:void 0}:void 0,request:f,status:"pending"}]}}),new Promise((l,p)=>{const h=g=>{const y=g.find(m=>m.request.id===f.id);if(!y&&g.length===0){a.delete(h),p(new Ne);return}y&&(y.status!=="success"&&y.status!=="error"||(a.delete(h),y.status==="success"?l(y.result):p(Nr(y.error)),o.setState(m=>({...m,requestQueue:m.requestQueue.filter(k=>k.request.id!==f.id)}))))};a.add(h)})}},{})}return xs({actions:{async addFunds(o){const{internal:d}=o,{request:f,store:l}=d;if(f.method!=="wallet_addFunds")throw new Error("Cannot add funds for method: "+f.method);return await c(l).request(f)},async createAccount(o){const{internal:d}=o,{client:f,config:l,request:p,store:h}=d,{storage:g}=l,y=c(h);return{account:await(async()=>{var k,A,z,O,P,T,U,$,b,I;if(p.method==="wallet_connect"){const[{capabilities:w,chainIds:v}]=p._decoded.params??[{}],E=Jt(((k=w==null?void 0:w.signInWithEthereum)==null?void 0:k.authUrl)??l.authUrl,{storage:g}),M=(O=(z=(A=p.params)==null?void 0:A[0])==null?void 0:z.capabilities)==null?void 0:O.signInWithEthereum,x=await ye(w==null?void 0:w.grantPermissions,{chainId:f.chain.id}),j=x?L(mt,gt(x)):void 0,{accounts:N}=await y.request({...p,params:[{capabilities:{...(T=(P=p.params)==null?void 0:P[0])==null?void 0:T.capabilities,grantPermissions:j,signInWithEthereum:E||M?{...M,authUrl:E}:void 0},chainIds:v==null?void 0:v.map(S=>_(S))}]}),[D]=N;if(!D)throw new Error("no account found.");const R=($=(U=D.capabilities)==null?void 0:U.admins)==null?void 0:$.map(S=>ie(S,{chainId:f.chain.id})).filter(Boolean),q=(I=(b=D.capabilities)==null?void 0:b.permissions)==null?void 0:I.map(S=>{try{const F=fr(V(gn,S));return F.id===(x==null?void 0:x.id)?{...F,...x,permissions:F.permissions}:F}catch{return}}).filter(Boolean),B=await(async()=>{var ge,X,ue,ce;if(!((ge=D.capabilities)!=null&&ge.signInWithEthereum))return;const{message:S,signature:F}=D.capabilities.signInWithEthereum;if(!E)return{message:S,signature:F};const{token:ee}=await gr({address:D.address,authUrl:E,message:S,publicKey:(ce=(ue=(X=D.capabilities)==null?void 0:X.admins)==null?void 0:ue[0])==null?void 0:ce.publicKey,signature:F});return{message:S,signature:F,token:ee}})();return{...ne({address:D.address,keys:[...R??[],...q??[]]}),signInWithEthereum:B}}throw new Error(`Account creation not supported on method: ${p.method}`)})()}},async disconnect(o){const{internal:d}=o,{config:f}=d,{storage:l}=f,p=await l.getItem("porto.authUrl")||void 0,h=Jt(f.authUrl??p,{storage:l});h&&await fetch(h.logout,{credentials:"include",method:"POST"}).catch(()=>{})},async getAccountVersion(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="wallet_getAccountVersion")throw new Error("Cannot get version for method: "+l.method);return r.supportsHeadless?await c(f).request(l):t.actions.getAccountVersion(o)},async getAssets(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="wallet_getAssets")throw new Error("Cannot get assets for method: "+l.method);if(!r.supportsHeadless)return t.actions.getAssets(o);const h=await c(f).request(l);return V(vn.Response,h)},async getCallsStatus(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="wallet_getCallsStatus")throw new Error("Cannot get status for method: "+l.method);return r.supportsHeadless?await c(f).request(l):t.actions.getCallsStatus(o)},async getCapabilities(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="wallet_getCapabilities")throw new Error("Cannot get capabilities for method: "+l.method);return r.supportsHeadless?await c(f).request(l):t.actions.getCapabilities(o)},async getKeys(o){const{account:d,chainIds:f,internal:l}=o,{store:p}=l,h=await(async()=>{if(!r.supportsHeadless)return t.actions.getKeys(o);const y=await c(p).request({method:"wallet_getKeys",params:[L(kt.Parameters,{address:d.address,chainIds:f})]});return V(kt.Response,y)})();return _r([...h,...d.keys??[]],g=>g.publicKey)},async grantAdmin(o){var m,k,A;const{internal:d}=o,{request:f,store:l}=d;if(f.method!=="wallet_grantAdmin")throw new Error("Cannot authorize admin for method: "+f.method);const[p]=f._decoded.params,h=ie(p.key);if(!h)throw new Error("no key found.");const g=await It(d,o);return await c(l).request({method:"wallet_grantAdmin",params:[{...(m=f.params)==null?void 0:m[0],capabilities:{...(A=(k=f.params)==null?void 0:k[0])==null?void 0:A.capabilities,feeToken:g}}]}),{key:h}},async grantPermissions(o){const{internal:d}=o,{client:f,request:l,store:p}=d;if(l.method!=="wallet_grantPermissions")throw new Error("Cannot grant permissions for method: "+l.method);const[{address:h,...g}]=l._decoded.params,y=await ye(g,{chainId:f.chain.id});if(!y)throw new Error("no key found.");const m=L(mt,gt(y));return await c(p).request({method:"wallet_grantPermissions",params:[m]}),{key:y}},async loadAccounts(o){const{internal:d}=o,{client:f,config:l,store:p}=d,{storage:h}=l,g=c(p),y=d.request;if(y.method!=="wallet_connect"&&y.method!=="eth_requestAccounts")throw new Error("Cannot load accounts for method: "+y.method);return{accounts:await(async()=>{var $,b,I,w,v,E,M;const[k]=y._decoded.params??[],{capabilities:A}=k??{},z=Jt((($=A==null?void 0:A.signInWithEthereum)==null?void 0:$.authUrl)??l.authUrl,{storage:h}),O=(w=(I=(b=y.params)==null?void 0:b[0])==null?void 0:I.capabilities)==null?void 0:w.signInWithEthereum,P=await ye(A==null?void 0:A.grantPermissions,{chainId:f.chain.id}),T=P?L(mt,gt(P)):void 0,{accounts:U}=await g.request({method:"wallet_connect",params:[{...(v=y.params)==null?void 0:v[0],capabilities:{...(M=(E=y.params)==null?void 0:E[0])==null?void 0:M.capabilities,grantPermissions:T,signInWithEthereum:z||O?{...O,authUrl:z}:void 0}}]});return Promise.all(U.map(async x=>{var R,q,B,S;const j=(q=(R=x.capabilities)==null?void 0:R.admins)==null?void 0:q.map(F=>ie(F)).filter(Boolean),N=(S=(B=x.capabilities)==null?void 0:B.permissions)==null?void 0:S.map(F=>{try{const ee=fr(V(gn,F));return ee.id===(P==null?void 0:P.id)?{...ee,...P,permissions:ee.permissions}:ee}catch{return}}).filter(Boolean),D=await(async()=>{var X,ue,ce,_n;if(!((X=x.capabilities)!=null&&X.signInWithEthereum))return;const{message:F,signature:ee}=x.capabilities.signInWithEthereum;if(!z)return{message:F,signature:ee};const{token:ge}=await gr({address:x.address,authUrl:z,message:F,publicKey:(_n=(ce=(ue=x.capabilities)==null?void 0:ue.admins)==null?void 0:ce[0])==null?void 0:_n.publicKey,signature:ee});return{message:F,signature:ee,token:ge}})();return{...ne({address:x.address,keys:[...j??[],...N??[]]}),signInWithEthereum:D}}))})()}},async prepareCalls(o){var m,k,A;const{account:d,internal:f}=o,{store:l,request:p}=f;if(p.method!=="wallet_prepareCalls")throw new Error("Cannot prepare calls for method: "+p.method);if(!r.supportsHeadless)return t.actions.prepareCalls(o);const h=await It(f,o),g=c(l),y=V(At.Response,await g.request({...p,params:[{...(m=p.params)==null?void 0:m[0],capabilities:{...(A=(k=p.params)==null?void 0:k[0])==null?void 0:A.capabilities,feeToken:h}}]}));return{account:d,chainId:Number(y.chainId),context:y.context,digest:y.digest,key:y.key,typedData:y.typedData}},async prepareUpgradeAccount(o){var O,P,T,U;const{internal:d}=o,{client:f,store:l,request:p}=d;if(p.method!=="wallet_prepareUpgradeAccount")throw new Error("Cannot prepare upgrade for method: "+p.method);if(!r.supportsHeadless)return t.actions.prepareUpgradeAccount(o);const[{capabilities:h}]=p._decoded.params??[{}],g=await ye(h==null?void 0:h.grantPermissions,{chainId:f.chain.id}),y=g?L(mt,gt(g)):void 0,m=c(l),{context:k,digests:A}=await m.request({...p,params:[{...(O=p.params)==null?void 0:O[0],capabilities:{...(T=(P=p.params)==null?void 0:P[0])==null?void 0:T.capabilities,grantPermissions:y}}]}),z=(U=k.account.keys)==null?void 0:U.map($=>$.id===(g==null?void 0:g.id)?{...$,...g}:$);return{context:{...k,account:{...k.account,keys:z}},digests:A}},async revokeAdmin(o){var k,A,z,O,P;const{account:d,id:f,internal:l}=o,{store:p,request:h}=l;if(h.method!=="wallet_revokeAdmin")throw new Error("Cannot revoke admin for method: "+h.method);const g=(k=d.keys)==null?void 0:k.find(T=>T.id===f);if(!g)return;if(g.type==="webauthn-p256"&&((A=d.keys)==null?void 0:A.filter(T=>T.type==="webauthn-p256").length)===1)throw new Error("revoke the only WebAuthn key left.");const y=await It(l,o);return await c(p).request({...h,params:[{...(z=h.params)==null?void 0:z[0],capabilities:{...(P=(O=h.params)==null?void 0:O[0])==null?void 0:P.capabilities,feeToken:y}}]})},async revokePermissions(o){var m;const{account:d,id:f,internal:l}=o,{store:p,request:h}=l;if(h.method!=="wallet_revokePermissions")throw new Error("Cannot revoke permissions for method: "+h.method);const g=(m=d.keys)==null?void 0:m.find(k=>k.id===f);if(!g)return;if(g.role==="admin")throw new Error("cannot revoke permissions.");return await c(p).request(h)},async sendCalls(o){var T,U,$,b,I,w,v,E;const{account:d,asTxHash:f,calls:l,chainId:p,internal:h,merchantUrl:g,requiredFunds:y}=o,{client:m,store:k,request:A}=h,z=c(k),O=await It(h,o),P=await wn({account:d,calls:l,permissionsId:o.permissionsId});if(P&&P.role==="session"){if(!r.supportsHeadless)return t.actions.sendCalls(o);try{const M=await z.request(L(At.Request,{method:"wallet_prepareCalls",params:[{calls:l,capabilities:{...A._decoded.method==="wallet_sendCalls"?(U=(T=A._decoded.params)==null?void 0:T[0])==null?void 0:U.capabilities:void 0,feeToken:O,merchantUrl:g,requiredFunds:y},chainId:p,from:d.address,key:P}]})),x=((b=($=M.capabilities)==null?void 0:$.quote)==null?void 0:b.quotes)??[];if(x.some((q,B)=>B===x.length-1&&x.length>1?!1:Nt(q.feeTokenDeficit)>0n))throw new Error("insufficient funds");const N=await Ie(P,{address:null,payload:M.digest,wrap:!1}),R=(await z.request({method:"wallet_sendPreparedCalls",params:[{...M,signature:N}]}))[0];if(!R)throw new Error("id not found");if(f){const{id:q,receipts:B,status:S}=await Ve(m,{id:R.id,pollingInterval:500});if(!(B!=null&&B[0]))throw S==="success"?new ct({message:"Call bundle with id: "+q+" not found."}):new Me({message:"Transaction failed under call bundle id: "+q+"."});return{id:B[0].transactionHash}}return R}catch{}}if(A.method==="eth_sendTransaction")return{id:await z.request({...A,params:[{...(I=A.params)==null?void 0:I[0],capabilities:{feeToken:O,merchantUrl:g},...p?{chainId:_(p)}:{}}]})};if(A.method==="wallet_sendCalls")return await z.request({method:"wallet_sendCalls",params:[{...(w=A.params)==null?void 0:w[0],capabilities:{...(E=(v=A.params)==null?void 0:v[0])==null?void 0:E.capabilities,feeToken:O,merchantUrl:g},...p?{chainId:_(p)}:{}}]});throw new Error("Cannot execute for method: "+A.method)},async sendPreparedCalls(o){var y;const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="wallet_sendPreparedCalls")throw new Error("Cannot send prepared calls for method: "+l.method);if(!r.supportsHeadless)return t.actions.sendPreparedCalls(o);const g=(y=(await c(f).request(l))[0])==null?void 0:y.id;if(!g)throw new Error("id not found");return g},async signPersonalMessage(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="personal_sign")throw new Error("Cannot sign personal message for method: "+l.method);return await c(f).request(l)},async signTypedData(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="eth_signTypedData_v4")throw new Error("Cannot sign typed data for method: "+l.method);return await c(f).request(l)},async switchChain(o){const{internal:d}=o,{store:f,request:l}=d;if(l.method!=="wallet_switchEthereumChain")throw new Error("Cannot switch chain for method: "+l.method);return r.supportsHeadless?await c(f).request(l):void 0},async upgradeAccount(o){const{account:d,internal:f}=o,{store:l,request:p}=f;if(p.method!=="wallet_upgradeAccount")throw new Error("Cannot upgrade account for method: "+p.method);return await c(l).request(p),{account:d}},async verifyEmail(o){const{internal:d}=o,{request:f,store:l}=d;if(f.method!=="account_verifyEmail")throw new Error("Cannot verify email for method: "+f.method);return await c(l).request(f)}},config:e,name:"dialog",setup(o){const{internal:d}=o,{store:f}=d,l=r.setup({host:n,internal:d,theme:s,themeController:i}),p=f.subscribe(h=>h.requestQueue,h=>{for(const y of a)y(h);const g=h.map(y=>y.status==="pending"?y:void 0).filter(Boolean);l.syncRequests(g).catch(()=>{}),g.length===0&&l.close()});return()=>{p(),l.destroy()}}})}async function It(e,t){const{config:{feeToken:n}}=e,{feeToken:r}=t??{};return r??n}function Jt(e,{storage:t}){if(!e)return;const n=Es(e,typeof window<"u"?window.location.origin:void 0);return n&&t.setItem("porto.authUrl",n),n}function gu(){const e=typeof indexedDB<"u"?Vi("porto","store"):void 0;return{async getItem(t){const n=await Gi(t,e);return n===null?null:n},async removeItem(t){await Zi(t,e)},async setItem(t,n){await Hi(t,_e(n),e)},sizeLimit:1024*1024*50}}function wu(){const e=new Map;return{getItem(t){return e.get(t)??null},removeItem(t){e.delete(t)},setItem(t,n){e.set(t,n)},sizeLimit:Number.POSITIVE_INFINITY}}const vr=typeof window<"u"&&typeof document<"u",we={announceProvider:!0,chains:ko,mode:vr?mu({host:Ur.prod}):zs(),relay:Ut(Rc.prod.http),storage:vr&&typeof indexedDB<"u"?gu():wu(),storageKey:"porto.store"};function bu(e={}){const t=e.chains??we.chains,n=Object.fromEntries(t.map(o=>{var d;return[o.id,((d=e.transports)==null?void 0:d[o.id])??Ut()]})),r={announceProvider:e.announceProvider??we.announceProvider,authUrl:e.authUrl,chains:t,feeToken:e.feeToken,merchantUrl:e.merchantUrl,mode:e.mode??we.mode,relay:e.relay??we.relay,storage:e.storage??we.storage,storageKey:e.storageKey??we.storageKey,transports:n},s=Bi(Fi(Yi(Wi(o=>({accounts:[],chainIds:r.chains.map(d=>d.id),feeToken:r.feeToken,requestQueue:[]}),{merge(o,d){var h;const f=o,l=((h=r.chains.find(g=>g.id===f.chainIds[0]))==null?void 0:h.id)??r.chains[0].id,p=[l,...r.chains.map(g=>g.id).filter(g=>g!==l)];return{...d,...f,chainIds:p}},name:r.storageKey,partialize:o=>({accounts:o.accounts.map(d=>_e(d)),chainIds:o.chainIds}),storage:r.storage,version:5}))));let i=r.mode;const a={config:r,getMode(){return i},id:En(),setMode(o){return c==null||c(),i=o,c=o.setup({internal:a}),c},store:s},u=Kc(a);let c=i!==null?i.setup({internal:a}):()=>{};return{_internal:a,config:r,destroy(){c(),u._internal.destroy()},provider:u}}const Au=Object.freeze(Object.defineProperty({__proto__:null,create:bu,defaultConfig:we},Symbol.toStringTag,{value:"Module"}));export{Au as Porto,Kc as from};
